import{S as ne}from"./school-repository-D0PX_JvD.js";import{d as Y,r as F,s as Z,o as ee,b as n,e as w,c as I,w as t,f as e,g as oe,h as ae,F as se,j as re,l as fe,u as D,x as X,i as B,m as C,z as u,A as R,v as Q,K as ge,y as be,T as ie,k as P,t as ue}from"./index-qu0X8Y0F.js";import{u as de}from"./vee-validate.esm-1pLNcP7m.js";const Se=Y({__name:"LevelRangeEditor",props:{initialLevelRanges:{}},emits:["close","save"],setup(q,{emit:E}){const r=q,N=E,x=F(0),f=F(""),m=F(),d=F([]);Z(()=>r.initialLevelRanges,()=>p());function p(){r.initialLevelRanges&&(d.value=JSON.parse(JSON.stringify(r.initialLevelRanges)),d.value.length>0&&(m.value=d.value[0]))}function G(i,a){const v=i.levels.indexOf(a);i.levels.splice(v,1)}function _(){const i=m.value;if(i){const a=d.value.findIndex(v=>v.price==i.price);d.value.splice(a,1),m.value=d.value[0]}}function k(){const i=+x.value;if(i==null||i==null||isNaN(i)||i==0||(x.value=0,d.value.findIndex(v=>v.price==i)!=-1))return;const a=m.value={price:i,levels:[]};d.value.push(a),d.value.sort((v,g)=>v.price-g.price)}function O(i){const a=f.value.trim();a.length!=0&&(f.value="",!i.levels.includes(a)&&i.levels.push(a))}return ee(()=>p()),(i,a)=>{const v=n("v-number-input"),g=n("v-col"),c=n("v-btn"),$=n("v-row"),b=n("v-tab"),T=n("v-tabs"),L=n("v-text-field"),A=n("v-icon"),M=n("v-list"),h=n("v-tabs-window-item"),J=n("v-tabs-window"),U=n("v-card"),y=n("v-card-text"),K=n("v-divider"),H=n("v-spacer"),o=n("v-card-actions");return w(),I(U,{"prepend-icon":"mdi-format-list-numbered",title:"Livelli"},{default:t(()=>[e(y,null,{default:t(()=>[e($,{class:"my-3 mb-10 justify-center"},{default:t(()=>[e(g,{class:"px-2",cols:"12",md:"4"},{default:t(()=>[e(v,{"max-width":"500",modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=l=>x.value=l),reverse:!1,controlVariant:"default",label:"Fascia di Prezzo",prefix:"€",hideInput:!1,inset:!1,min:0},null,8,["modelValue"])]),_:1}),e(g,{class:"px-2",cols:"12",md:"1"},{default:t(()=>[e(c,{onClick:k,icon:"mdi-plus",color:"success"}),e(c,{onClick:_,icon:"mdi-minus",color:"error"})]),_:1})]),_:1}),m.value?(w(),I(U,{key:0,class:"mx-5 mt-5 pa-2",elevation:"3"},{default:t(()=>[e(T,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=l=>m.value=l),class:"my-2","align-tabs":"center",color:"primary","show-arrows":""},{default:t(()=>[(w(!0),oe(se,null,ae(d.value,l=>(w(),I(b,{key:l.price,text:l.price+" €",value:l},null,8,["text","value"]))),128))]),_:1},8,["modelValue"]),e(J,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=l=>m.value=l)},{default:t(()=>[(w(!0),oe(se,null,ae(d.value,l=>(w(),I(h,{class:"mx-5 my-5",key:l.price,value:l},{default:t(()=>[e(L,{modelValue:f.value,"onUpdate:modelValue":a[2]||(a[2]=S=>f.value=S),label:"Nome Livello","append-icon":"mdi-plus",type:"text","onClick:append":S=>O(l)},null,8,["modelValue","onClick:append"]),e(M,{items:l.levels},{append:t(({item:S})=>[e(A,{size:"small",onClick:V=>G(l,S)},{default:t(()=>a[6]||(a[6]=[fe(" mdi-delete ")])),_:2},1032,["onClick"])]),_:2},1032,["items"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):re("",!0)]),_:1}),e(K),e(o,null,{default:t(()=>[e(H),e(c,{text:"Annulla",variant:"plain",onClick:a[4]||(a[4]=l=>N("close"))}),e(c,{color:"primary",text:"Salva Livelli",variant:"tonal",onClick:a[5]||(a[5]=l=>N("save",d.value))})]),_:1})]),_:1})}}}),Ve=Y({__name:"ManagerEditor",props:{initialManagerOptions:{}},emits:["close","save"],setup(q,{emit:E}){const r=q,N=E,x=D({totalStudents:X().required("Il Numero Totale degli Studenti è obbligatorio").positive().label("Numero Totale Studenti"),quotePerStudent:X().required("La Quota per Studente è obbligatoria").positive().label("Quota per Studente"),cashFund:X().positive().label("Fondo Cassa").nullable().optional()}),{defineField:f,handleSubmit:m}=de({validationSchema:x}),d=g=>({props:{"error-messages":g.errors}}),[p,G]=f("totalStudents",d),[_,k]=f("quotePerStudent",d),[O,i]=f("cashFund",d),a=m(async g=>{N("save",{...g})},g=>{B.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(g)});Z(()=>r.initialManagerOptions,()=>v());function v(){r.initialManagerOptions&&(p.value=r.initialManagerOptions.totalStudents,_.value=r.initialManagerOptions.quotePerStudent,O.value=r.initialManagerOptions.cashFund)}return ee(()=>v()),(g,c)=>{const $=n("v-number-input"),b=n("v-col"),T=n("v-row"),L=n("v-card-text"),A=n("v-divider"),M=n("v-spacer"),h=n("v-btn"),J=n("v-card-actions"),U=n("v-card");return w(),I(U,{"prepend-icon":"mdi-account",title:"Gestione Scuola"},{default:t(()=>[e(L,null,{default:t(()=>[e(T,{class:"my-3 mb-10 justify-center"},{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e($,C({modelValue:u(p),"onUpdate:modelValue":c[0]||(c[0]=y=>R(p)?p.value=y:null)},u(G),{reverse:!1,controlVariant:"default",label:"Numero Totale Studenti",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e($,C({modelValue:u(_),"onUpdate:modelValue":c[1]||(c[1]=y=>R(_)?_.value=y:null)},u(k),{reverse:!1,controlVariant:"default",label:"Quota per Studente",prefix:"€",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e($,C({modelValue:u(O),"onUpdate:modelValue":c[2]||(c[2]=y=>R(O)?O.value=y:null)},u(i),{reverse:!1,controlVariant:"default",label:"Fondo Cassa",hideInput:!1,prefix:"€",inset:!1,min:0}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A),e(J,null,{default:t(()=>[e(M),e(h,{text:"Annulla",variant:"plain",onClick:c[3]||(c[3]=y=>N("close"))}),e(h,{color:"primary",text:"Salva Gestione",variant:"tonal",onClick:u(a)},null,8,["onClick"])]),_:1})]),_:1})}}}),xe={class:"v-input--center-affix v-input--error"},ye={class:"v-input__details"},Ce={class:"v-messages__message v-messages",role:"alert"},Ne={class:"v-input--center-affix v-input--error"},we={class:"v-input__details"},ke={class:"v-messages__message v-messages",role:"alert"},Re=Y({__name:"SchoolEditor",props:{initialSchool:{},edit:{type:Boolean}},emits:["close","save"],setup(q,{emit:E}){const r=q,N=E,x=F(!1),f=F(!1),m=F(!1),d=D({name:Q().required("Il Nome è obbligatorio").min(1).label("Nome"),city:Q().label("Città").nullable().optional(),email:Q().label("Email").nullable().optional(),phoneNumber:Q().label("Numero di Telefono").nullable().optional(),managed:ge().label("Gestione"),managerOptions:D().test({test:o=>b.value?o!==void 0:!0,message:"Configurare la Gestione della Scuola correttamente",exclusive:!1,name:"managedProp"}).label("Opzioni Gestione"),levelRanges:be().of(D()).test({test:o=>!!o&&o.length!=0,message:"I livelli sono obbligatori; configurare correttamente i Livelli",exclusive:!1,name:"level"}).label("Livelli")}),{defineField:p,handleSubmit:G}=de({validationSchema:d}),_=o=>({props:{"error-messages":o.errors}}),[k,O]=p("name",_),[i,a]=p("city",_),[v,g]=p("email",_),[c,$]=p("phoneNumber",_),[b,T]=p("managed",_),[L,A]=p("managerOptions",_),[M,h]=p("levelRanges",_),J=G(async o=>{H(o)},o=>{B.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(o)});Z(()=>r.initialSchool,()=>U());function U(){if(r.initialSchool){const o=JSON.parse(JSON.stringify(r.initialSchool));k.value=o.name,i.value=o.city??"",v.value=o.email??"",c.value=o.phoneNumber??"",b.value=o.managed,L.value=o.managerOptions,M.value=o.levelRanges}}function y(o){console.log(o,JSON.stringify(o)),L.value=o,f.value=!1}function K(o){console.log(o,JSON.stringify(o)),M.value=o,x.value=!1}async function H(o){var S,V;m.value=!0;const l={...o};l.createdAt=r.edit?(S=r.initialSchool)==null?void 0:S.createdAt:ie.now(),l.updatedAt=ie.now(),b.value&&(l.managerOptions=L.value);try{r.edit&&((V=r.initialSchool)==null?void 0:V.id)!=null?(await ne.instance.save(l,r.initialSchool.id),B.success("Scuola Aggiornata")):(await ne.instance.save(l),B.success("Scuola Creata")),N("save",l)}catch(W){N("save"),B.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",W)}finally{m.value=!1}}return ee(()=>U()),(o,l)=>{const S=n("v-text-field"),V=n("v-col"),W=n("v-checkbox"),j=n("v-btn"),le=n("v-dialog"),te=n("v-row"),ce=n("v-card-text"),ve=n("v-divider"),me=n("v-spacer"),pe=n("v-card-actions"),_e=n("v-card");return w(),I(_e,{"prepend-icon":"mdi-school",title:"Scuola"},{default:t(()=>[e(ce,null,{default:t(()=>[e(te,{dense:""},{default:t(()=>[e(V,{cols:"12",md:"6"},{default:t(()=>[e(S,C({modelValue:u(k),"onUpdate:modelValue":l[0]||(l[0]=s=>R(k)?k.value=s:null)},u(O),{label:"Nome",required:""}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(S,C({modelValue:u(i),"onUpdate:modelValue":l[1]||(l[1]=s=>R(i)?i.value=s:null)},u(a),{label:"Città"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(S,C({modelValue:u(v),"onUpdate:modelValue":l[2]||(l[2]=s=>R(v)?v.value=s:null)},u(g),{label:"Email"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(S,C({modelValue:u(c),"onUpdate:modelValue":l[3]||(l[3]=s=>R(c)?c.value=s:null)},u($),{label:"Numero di Telefono"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"12"},{default:t(()=>[e(te,{"justify-center":""},{default:t(()=>[e(V,{class:"align-self-center"},{default:t(()=>[e(W,C({modelValue:u(b),"onUpdate:modelValue":l[4]||(l[4]=s=>R(b)?b.value=s:null)},u(T),{label:"Gestione"}),null,16,["modelValue"])]),_:1}),e(V,{class:"align-self-center"},{default:t(()=>[u(b)?(w(),I(le,{key:0,modelValue:f.value,"onUpdate:modelValue":l[7]||(l[7]=s=>f.value=s),fullscreen:""},{activator:t(({props:s})=>{var z;return[P("div",xe,[e(j,C({text:"Gestione"},s),null,16),P("div",ye,[P("div",Ce,[P("span",null,ue((z=u(A)["error-messages"])==null?void 0:z[0]),1)])])])]}),default:t(()=>[e(Ve,{initialManagerOptions:u(L),onClose:l[5]||(l[5]=s=>f.value=!1),onSave:l[6]||(l[6]=s=>y(s))},null,8,["initialManagerOptions"])]),_:1},8,["modelValue"])):re("",!0)]),_:1})]),_:1})]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(le,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=s=>x.value=s),fullscreen:""},{activator:t(({props:s})=>{var z;return[P("div",Ne,[e(j,C({text:"Gestisci Livelli"},s),null,16),P("div",we,[P("div",ke,[P("span",null,ue((z=u(h)["error-messages"])==null?void 0:z[0]),1)])])])]}),default:t(()=>[e(Se,{initialLevelRanges:u(M),onClose:l[8]||(l[8]=s=>x.value=!1),onSave:l[9]||(l[9]=s=>K(s))},null,8,["initialLevelRanges"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ve),e(pe,null,{default:t(()=>[e(me),e(j,{text:"Chiudi",variant:"plain",onClick:l[11]||(l[11]=s=>N("close"))}),e(j,{color:"primary",loading:m.value,disabled:m.value,text:o.edit?"Salva Modifiche":"Crea",variant:"tonal",onClick:u(J)},null,8,["loading","disabled","text","onClick"])]),_:1})]),_:1})}}});export{Re as _};

var b=Object.defineProperty;var S=(t,e,s)=>e in t?b(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var c=(t,e,s)=>S(t,typeof e!="symbol"?e+"":e,s);import{R as v,P as E,S as R,q as w,U as r,V as y,W as l,X as u,Y as g,Z as _,_ as L,$ as A}from"./index-DqQs06DF.js";var d=(t=>(t.SCHOOLS="schools",t.STUDENTS="students",t.WEEKLY_LESSONS="weeklyLessons",t.DAILY_LESSONS="dailyLessons",t.RECOVERY_LESSONS="recoveryLessons",t))(d||{});const O=()=>({toFirestore:t=>t,fromFirestore:t=>{const e=t.data();return e.id=t.id,e}}),m=t=>v(E(),t).withConverter(O());function x(t,e){const s=`${t}/${e}/user${t.charAt(0).toUpperCase()+t.slice(1)}`;return m(s)}class D{constructor(){c(this,"handlers",[]);c(this,"unsubscription")}subscribe(e){return this.handlers.push(e),new C(this,e)}unsubscribe(e){var n;const s=this.handlers.indexOf(e);s!==-1&&this.handlers.splice(s,1),this.handlers.length==0&&((n=this.unsubscription)==null||n.call(this))}unsubscribeAll(){this.clear()}setUnsubscription(e){this.unsubscription=e}next(e){[...this.handlers].forEach(s=>s.next(e))}error(e){[...this.handlers].forEach(s=>{var n;return(n=s.error)==null?void 0:n.call(s,e)}),console.log(e)}clear(){this.handlers=[]}expose(){return this}}class C{constructor(e,s){this.liteEvent=e,this.handler=s}unsubscribe(){this.liteEvent.unsubscribe(this.handler)}}class U{constructor(e){c(this,"user",R());c(this,"cache",{});this._collectionReference=e}get collectionReference(){var e,s,n;return(this.cache.userId!=((e=this.user.value)==null?void 0:e.uid)||!this.cache.collectionReference)&&(this.cache={userId:(s=this.user.value)==null?void 0:s.uid,collectionReference:this._collectionReference(((n=this.user.value)==null?void 0:n.uid)??"")}),this.cache.collectionReference}observe(e){return w(()=>r(this.collectionReference,e.value))}async get(e){return(await this.getDoc(e)).data()}async getDoc(e){return await y(r(this.collectionReference,e))}async getAll(...e){const s=l(this.collectionReference,...e);return(await u(s)).docs.map(o=>o.data())}async getAllDocs(...e){const s=l(this.collectionReference,...e);return await u(s)}async save(e,s){return s!=null?(g(r(this.collectionReference,s),e),s):(await _(this.collectionReference,e)).id}observeAll(...e){const s=new D,n=l(this.collectionReference,...e),o=L(n,a=>{const f=a.docs.map(p=>p.data());s.next(f)},a=>{s.error(a)});return s.setUnsubscription(o),s}async delete(e){await A(r(this.collectionReference,e))}deleteAll(){throw new Error("Method not implemented.")}}const i=class i extends U{constructor(){super(e=>x(d.SCHOOLS,e))}static get instance(){return this._instance||(this._instance=new i),this._instance}};c(i,"_instance",null);let h=i;export{U as A,d as D,h as S,x as u};

import{_ as R}from"./BackButton.vue_vue_type_script_setup_true_lang-CEXhIt5T.js";import{u as x,D as I}from"./abstract-repository-DlvEjJ0c.js";import{y as D,T as O}from"./model-BjBmgxIT.js";import{L as W,a as T}from"./lesson-group-service-BtlVGGcN.js";import{d as L,E as B,G,r as A,L as H,M as F,N as Y,O as z,P as N,Q,R as U,S as q,o as J,z as d,c as K,w as b,j as X,I as Z,b as w,e as ee,f,W as te,H as ae}from"./index-ReAJFkyG.js";var $;(function(t){t.DragAndDrop="dragAndDrop",t.EventModal="eventModal",t.ScrollController="scrollController",t.EventRecurrence="eventRecurrence",t.Resize="resize",t.CalendarControls="calendarControls",t.CurrentTime="currentTime"})($||($={}));const re=/^(0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/,ne=/^(\d{4})-(\d{2})-(\d{2})$/;class ie extends Error{constructor(e){super(`Invalid time string: ${e}`)}}class oe extends Error{constructor(e,r){super(`Number must be between ${e} and ${r}.`),Object.defineProperty(this,"min",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"max",{enumerable:!0,configurable:!0,writable:!0,value:r})}}const S=t=>{if(t<0||t>99)throw new oe(0,99);return String(t).padStart(2,"0")},M=1.6666666666666667,C=t=>{if(!re.test(t)&&t!=="24:00")throw new ie(t);const[e,r]=t.split(":").map(i=>parseInt(i,10));let n=(r*M).toString();return n.split(".")[0].length<2&&(n=`0${n}`),Number(e+n)},_=t=>{const e=Math.floor(t/100),r=Math.round(t%100/M);return`${S(e)}:${S(r)}`},se=(t,e)=>(e.name=t,e);class le{constructor(){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:$.CalendarControls}),Object.defineProperty(this,"$app",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getDate",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.datePickerState.selectedDate.value}),Object.defineProperty(this,"getView",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.calendarState.view.value}),Object.defineProperty(this,"getFirstDayOfWeek",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.firstDayOfWeek.value}),Object.defineProperty(this,"getLocale",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.locale.value}),Object.defineProperty(this,"getViews",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.views.value}),Object.defineProperty(this,"getDayBoundaries",{enumerable:!0,configurable:!0,writable:!0,value:()=>({start:_(this.$app.config.dayBoundaries.value.start),end:_(this.$app.config.dayBoundaries.value.end)})}),Object.defineProperty(this,"getWeekOptions",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.weekOptions.value}),Object.defineProperty(this,"getCalendars",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.calendars.value}),Object.defineProperty(this,"getMinDate",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.minDate.value}),Object.defineProperty(this,"getMaxDate",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.maxDate.value}),Object.defineProperty(this,"getMonthGridOptions",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.config.monthGridOptions.value}),Object.defineProperty(this,"getRange",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.$app.calendarState.range.value})}beforeRender(e){this.$app=e}onRender(e){this.$app=e}setDate(e){if(!ne.test(e))throw new Error("Invalid date. Expected format YYYY-MM-DD");this.$app.datePickerState.selectedDate.value=e}setView(e){if(!this.$app.config.views.value.find(n=>n.name===e))throw new Error(`Invalid view name. Expected one of ${this.$app.config.views.value.map(n=>n.name).join(", ")}`);this.$app.calendarState.setView(e,this.$app.datePickerState.selectedDate.value)}setFirstDayOfWeek(e){this.$app.config.firstDayOfWeek.value=e}setLocale(e){this.$app.config.locale.value=e}setViews(e){const r=this.$app.calendarState.view.value;if(!e.some(i=>i.name===r))throw new Error(`Currently active view is not in given views. Expected to find ${r} in ${e.map(i=>i.name).join(",")}`);this.$app.config.views.value=e}setDayBoundaries(e){this.$app.config.dayBoundaries.value={start:C(e.start),end:C(e.end)}}setWeekOptions(e){this.$app.config.weekOptions.value={...this.$app.config.weekOptions.value,...e}}setCalendars(e){this.$app.config.calendars.value=e}setMinDate(e){this.$app.config.minDate.value=e}setMaxDate(e){this.$app.config.maxDate.value=e}setMonthGridOptions(e){this.$app.config.monthGridOptions.value=e}}const ue=()=>se("calendarControls",new le),me=L({__name:"SchoolLessonView",setup(t){const e=Z(),r=x(I.SCHOOLS),n=B(()=>ae(r,e.params.id)),i=G(n),c=[],v=A(!1),o=H(),P=F(),y=ue(),j=Y({locale:"it-IT",views:[z(),N(),Q(),U()],defaultView:q.name,events:[],plugins:[o,P,y],callbacks:{beforeRender(a){const s=a.calendarState.range.value;m(s)},onRangeUpdate(a){m(a)}}});function E(){c.forEach(a=>{a._options||(a._options={}),o.get(a.id)?o.update(a):o.add(a)}),o.getAll().forEach(a=>{c.findIndex(l=>l.id==a.id)==-1&&o.remove(a.id)})}async function m(a){if(a??(a=y.getRange()),!a||!i.value)return;c.length=0,v.value=!0;const s={date:D.fromDate(new Date(a.start)),time:O.fromHHMM(a.start.split(" ")[1])},l={date:D.fromDate(new Date(a.end)),time:O.fromHHMM(a.end.split(" ")[1])},u=await W.instance.getCalendarLessons(i.value.id,s,l),g=Array.from(new Set(u.map(p=>p.title).filter(Boolean))),k=await T.instance.getStudentsOfSchoolWithIds(i.value.id,g);u.forEach(p=>{const h=k.find(V=>V.id==p.title);h&&(p.title=h.name+" "+h.surname)}),c.push(...u),E(),v.value=!1}return J(async()=>{m()}),(a,s)=>{const l=w("v-progress-linear"),u=w("v-container"),g=w("v-card");return d(i)?(ee(),K(g,{key:0,class:"pa-3",title:d(i).name,elevation:"0"},{prepend:b(()=>[f(R)]),default:b(()=>[f(u,null,{default:b(()=>[f(l,{active:v.value,color:"primary",indeterminate:""},null,8,["active"]),f(d(te),{"calendar-app":d(j)},null,8,["calendar-app"])]),_:1})]),_:1},8,["title"])):X("",!0)}}});export{me as default};

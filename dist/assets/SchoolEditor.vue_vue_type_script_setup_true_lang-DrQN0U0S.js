import{S as te}from"./school-repository-B0jre010.js";import{d as Y,r as U,n as Z,o as re,b as a,e as w,c as F,w as n,f as e,g as ne,h as ae,F as oe,j as ue,l as fe,i as j,m as C,u as r,p as R,T as se,k as P,t as ie}from"./index-D9byFOU4.js";import{c as D,b as X,u as de,a as Q,f as ge,d as be}from"./index.esm-BZ-Ns26G.js";const Se=Y({__name:"LevelRangeEditor",props:{initialLevelRanges:{}},emits:["close","save"],setup(q,{emit:E}){const u=q,N=E,x=U(0),g=U(""),v=U(),d=U([]);Z(()=>u.initialLevelRanges,()=>p());function p(){u.initialLevelRanges&&(d.value=JSON.parse(JSON.stringify(u.initialLevelRanges)),d.value.length>0&&(v.value=d.value[0]))}function G(i,o){const m=i.levels.indexOf(o);i.levels.splice(m,1)}function _(){const i=v.value;if(i){const o=d.value.findIndex(m=>m.price==i.price);d.value.splice(o,1),v.value=d.value[0]}}function k(){const i=+x.value;if(i==null||i==null||isNaN(i)||i==0||(x.value=0,d.value.findIndex(m=>m.price==i)!=-1))return;const o=v.value={price:i,levels:[]};d.value.push(o),d.value.sort((m,b)=>m.price-b.price)}function O(i){const o=g.value.trim();o.length!=0&&(g.value="",!i.levels.includes(o)&&i.levels.push(o))}return re(()=>p()),(i,o)=>{const m=a("v-number-input"),b=a("v-col"),c=a("v-btn"),h=a("v-row"),f=a("v-tab"),T=a("v-tabs"),L=a("v-text-field"),A=a("v-icon"),$=a("v-list"),I=a("v-tabs-window-item"),J=a("v-tabs-window"),M=a("v-card"),y=a("v-card-text"),H=a("v-divider"),K=a("v-spacer"),t=a("v-card-actions");return w(),F(M,{"prepend-icon":"mdi-format-list-numbered",title:"Livelli"},{default:n(()=>[e(y,null,{default:n(()=>[e(h,{class:"my-3 mb-10 justify-center"},{default:n(()=>[e(b,{class:"px-2",cols:"12",md:"4"},{default:n(()=>[e(m,{"max-width":"500",modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=l=>x.value=l),reverse:!1,controlVariant:"default",label:"Fascia di Prezzo",prefix:"€",hideInput:!1,inset:!1,min:0},null,8,["modelValue"])]),_:1}),e(b,{class:"px-2",cols:"12",md:"1"},{default:n(()=>[e(c,{onClick:k,icon:"mdi-plus",color:"success"}),e(c,{onClick:_,icon:"mdi-minus",color:"error"})]),_:1})]),_:1}),v.value?(w(),F(M,{key:0,class:"mx-5 mt-5 pa-2",elevation:"3"},{default:n(()=>[e(T,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=l=>v.value=l),class:"my-2","align-tabs":"center",color:"primary","show-arrows":""},{default:n(()=>[(w(!0),ne(oe,null,ae(d.value,l=>(w(),F(f,{key:l.price,text:l.price+" €",value:l},null,8,["text","value"]))),128))]),_:1},8,["modelValue"]),e(J,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=l=>v.value=l)},{default:n(()=>[(w(!0),ne(oe,null,ae(d.value,l=>(w(),F(I,{class:"mx-5 my-5",key:l.price,value:l},{default:n(()=>[e(L,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=S=>g.value=S),label:"Nome Livello","append-icon":"mdi-plus",type:"text","onClick:append":S=>O(l)},null,8,["modelValue","onClick:append"]),e($,{items:l.levels},{append:n(({item:S})=>[e(A,{size:"small",onClick:V=>G(l,S)},{default:n(()=>o[6]||(o[6]=[fe(" mdi-delete ")])),_:2},1032,["onClick"])]),_:2},1032,["items"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):ue("",!0)]),_:1}),e(H),e(t,null,{default:n(()=>[e(K),e(c,{text:"Annulla",variant:"plain",onClick:o[4]||(o[4]=l=>N("close"))}),e(c,{color:"primary",text:"Salva Livelli",variant:"tonal",onClick:o[5]||(o[5]=l=>N("save",d.value))})]),_:1})]),_:1})}}}),Ve=Y({__name:"ManagerEditor",props:{initialManagerOptions:{}},emits:["close","save"],setup(q,{emit:E}){const u=q,N=E,x=D({totalStudents:X().required("Il Numero Totale degli Studenti è obbligatorio").positive().label("Numero Totale Studenti"),quotePerStudent:X().required("La Quota per Studente è obbligatoria").positive().label("Quota per Studente"),cashFund:X().positive().label("Fondo Cassa").nullable().optional()}),{defineField:g,handleSubmit:v}=de({validationSchema:x}),d=b=>({props:{"error-messages":b.errors}}),[p,G]=g("totalStudents",d),[_,k]=g("quotePerStudent",d),[O,i]=g("cashFund",d),o=v(async b=>{N("save",{...b})},b=>{j.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(b)});Z(()=>u.initialManagerOptions,()=>m(),{immediate:!0});function m(){u.initialManagerOptions&&(p.value=u.initialManagerOptions.totalStudents,_.value=u.initialManagerOptions.quotePerStudent,O.value=u.initialManagerOptions.cashFund)}return(b,c)=>{const h=a("v-number-input"),f=a("v-col"),T=a("v-row"),L=a("v-card-text"),A=a("v-divider"),$=a("v-spacer"),I=a("v-btn"),J=a("v-card-actions"),M=a("v-card");return w(),F(M,{"prepend-icon":"mdi-account",title:"Gestione Scuola"},{default:n(()=>[e(L,null,{default:n(()=>[e(T,{class:"my-3 mb-10 justify-center"},{default:n(()=>[e(f,{cols:"12",md:"6"},{default:n(()=>[e(h,C({modelValue:r(p),"onUpdate:modelValue":c[0]||(c[0]=y=>R(p)?p.value=y:null)},r(G),{reverse:!1,controlVariant:"default",label:"Numero Totale Studenti",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:n(()=>[e(h,C({modelValue:r(_),"onUpdate:modelValue":c[1]||(c[1]=y=>R(_)?_.value=y:null)},r(k),{reverse:!1,controlVariant:"default",label:"Quota per Studente",prefix:"€",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(f,{cols:"12",md:"6"},{default:n(()=>[e(h,C({modelValue:r(O),"onUpdate:modelValue":c[2]||(c[2]=y=>R(O)?O.value=y:null)},r(i),{reverse:!1,controlVariant:"default",label:"Fondo Cassa",hideInput:!1,prefix:"€",inset:!1,min:0}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A),e(J,null,{default:n(()=>[e($),e(I,{text:"Annulla",variant:"plain",onClick:c[3]||(c[3]=y=>N("close"))}),e(I,{color:"primary",text:"Salva Gestione",variant:"tonal",onClick:r(o)},null,8,["onClick"])]),_:1})]),_:1})}}}),xe={class:"v-input--center-affix v-input--error"},ye={class:"v-input__details"},Ce={class:"v-messages__message v-messages",role:"alert"},Ne={class:"v-input--center-affix v-input--error"},we={class:"v-input__details"},ke={class:"v-messages__message v-messages",role:"alert"},Re=Y({__name:"SchoolEditor",props:{initialSchool:{},edit:{type:Boolean}},emits:["close","save"],setup(q,{emit:E}){const u=q,N=E,x=U(!1),g=U(!1),v=U(!1),d=D({name:Q().required("Il Nome è obbligatorio").min(1).label("Nome"),city:Q().label("Città").nullable().optional(),email:Q().label("Email").nullable().optional(),phoneNumber:Q().label("Numero di Telefono").nullable().optional(),managed:ge().label("Gestione"),managerOptions:D().test({test:t=>f.value?t!==void 0:!0,message:"Configurare la Gestione della Scuola correttamente",exclusive:!1,name:"managedProp"}).label("Opzioni Gestione"),levelRanges:be().of(D()).test({test:t=>!!t&&t.length!=0,message:"I livelli sono obbligatori; configurare correttamente i Livelli",exclusive:!1,name:"level"}).label("Livelli")}),{defineField:p,handleSubmit:G}=de({validationSchema:d}),_=t=>({props:{"error-messages":t.errors}}),[k,O]=p("name",_),[i,o]=p("city",_),[m,b]=p("email",_),[c,h]=p("phoneNumber",_),[f,T]=p("managed",_),[L,A]=p("managerOptions",_),[$,I]=p("levelRanges",_),J=G(async t=>{K(t)},t=>{j.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(t)});Z(()=>u.initialSchool,()=>M());function M(){if(u.initialSchool){const t=JSON.parse(JSON.stringify(u.initialSchool));k.value=t.name,i.value=t.city??"",m.value=t.email??"",c.value=t.phoneNumber??"",f.value=t.managed,L.value=t.managerOptions,$.value=t.levelRanges}}function y(t){console.log(t,JSON.stringify(t)),L.value=t,g.value=!1}function H(t){console.log(t,JSON.stringify(t)),$.value=t,x.value=!1}async function K(t){var S,V;v.value=!0;const l={name:t.name,managed:f.value??!1,levelRanges:t.levelRanges,createdAt:u.edit?(S=u.initialSchool)==null?void 0:S.createdAt:se.now(),updatedAt:se.now()};t.city&&(l.city=t.city),t.email&&(l.email=t.email),t.phoneNumber&&(l.phoneNumber=t.phoneNumber),f.value&&(l.managerOptions=L.value);try{u.edit&&((V=u.initialSchool)==null?void 0:V.id)!=null?(await te.instance.save(l,u.initialSchool.id),j.success("Scuola Aggiornata")):(await te.instance.save(l),j.success("Scuola Creata")),N("save",l)}catch(W){N("save"),j.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",W)}finally{v.value=!1}}return re(()=>M()),(t,l)=>{const S=a("v-text-field"),V=a("v-col"),W=a("v-checkbox"),z=a("v-btn"),ee=a("v-dialog"),le=a("v-row"),ce=a("v-card-text"),ve=a("v-divider"),me=a("v-spacer"),pe=a("v-card-actions"),_e=a("v-card");return w(),F(_e,{"prepend-icon":"mdi-school",title:"Scuola"},{default:n(()=>[e(ce,null,{default:n(()=>[e(le,{dense:""},{default:n(()=>[e(V,{cols:"12",md:"6"},{default:n(()=>[e(S,C({modelValue:r(k),"onUpdate:modelValue":l[0]||(l[0]=s=>R(k)?k.value=s:null)},r(O),{label:"Nome",required:""}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:n(()=>[e(S,C({modelValue:r(i),"onUpdate:modelValue":l[1]||(l[1]=s=>R(i)?i.value=s:null)},r(o),{label:"Città"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:n(()=>[e(S,C({modelValue:r(m),"onUpdate:modelValue":l[2]||(l[2]=s=>R(m)?m.value=s:null)},r(b),{label:"Email"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:n(()=>[e(S,C({modelValue:r(c),"onUpdate:modelValue":l[3]||(l[3]=s=>R(c)?c.value=s:null)},r(h),{label:"Numero di Telefono"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"12"},{default:n(()=>[e(le,{"justify-center":""},{default:n(()=>[e(V,{class:"align-self-center"},{default:n(()=>[e(W,C({modelValue:r(f),"onUpdate:modelValue":l[4]||(l[4]=s=>R(f)?f.value=s:null)},r(T),{label:"Gestione"}),null,16,["modelValue"])]),_:1}),e(V,{class:"align-self-center"},{default:n(()=>[r(f)?(w(),F(ee,{key:0,modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=s=>g.value=s),fullscreen:""},{activator:n(({props:s})=>{var B;return[P("div",xe,[e(z,C({text:"Gestione"},s),null,16),P("div",ye,[P("div",Ce,[P("span",null,ie((B=r(A)["error-messages"])==null?void 0:B[0]),1)])])])]}),default:n(()=>[e(Ve,{initialManagerOptions:r(L),onClose:l[5]||(l[5]=s=>g.value=!1),onSave:l[6]||(l[6]=s=>y(s))},null,8,["initialManagerOptions"])]),_:1},8,["modelValue"])):ue("",!0)]),_:1})]),_:1})]),_:1}),e(V,{cols:"12",md:"6"},{default:n(()=>[e(ee,{modelValue:x.value,"onUpdate:modelValue":l[10]||(l[10]=s=>x.value=s),fullscreen:""},{activator:n(({props:s})=>{var B;return[P("div",Ne,[e(z,C({text:"Gestisci Livelli"},s),null,16),P("div",we,[P("div",ke,[P("span",null,ie((B=r(I)["error-messages"])==null?void 0:B[0]),1)])])])]}),default:n(()=>[e(Se,{initialLevelRanges:r($),onClose:l[8]||(l[8]=s=>x.value=!1),onSave:l[9]||(l[9]=s=>H(s))},null,8,["initialLevelRanges"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ve),e(pe,null,{default:n(()=>[e(me),e(z,{text:"Chiudi",variant:"plain",onClick:l[11]||(l[11]=s=>N("close"))}),e(z,{color:"primary",loading:v.value,disabled:v.value,text:t.edit?"Salva Modifiche":"Crea",variant:"tonal",onClick:r(J)},null,8,["loading","disabled","text","onClick"])]),_:1})]),_:1})}}});export{Re as _};

import{S as oe}from"./model-C9r2bJ5b.js";import{S as ie}from"./school-repository-CYp-u7XN.js";import{d as le,r as F,n as ae,o as ve,b as t,e as P,c as I,w as a,f as e,g as se,h as re,F as ue,j as me,l as Ve,i as z,m as N,u as s,q as R,T as de,k as $,t as ce}from"./index-j92a3A_3.js";import{c as K,e as ee,u as pe,a as D,f as xe,d as Ne}from"./index.esm-PQuIfhzk.js";const Ce=le({__name:"LevelRangeEditor",props:{initialLevelRanges:{}},emits:["close","save"],setup(A,{emit:G}){const r=A,k=G,V=F(0),_=F(""),v=F(),c=F([]);ae(()=>r.initialLevelRanges,()=>w());function w(){r.initialLevelRanges&&(c.value=JSON.parse(JSON.stringify(r.initialLevelRanges)),c.value.length>0&&(v.value=c.value[0]))}function g(u,o){const f=u.levels.indexOf(o);u.levels.splice(f,1)}function U(){const u=v.value;if(u){const o=c.value.findIndex(f=>f.price==u.price);c.value.splice(o,1),v.value=c.value[0]}}function b(){const u=+V.value;if(u==null||u==null||isNaN(u)||u==0||(V.value=0,c.value.findIndex(f=>f.price==u)!=-1))return;const o=v.value={price:u,levels:[]};c.value.push(o),c.value.sort((f,m)=>f.price-m.price)}function x(u){const o=_.value.trim();o.length!=0&&(_.value="",!u.levels.includes(o)&&u.levels.push(o))}return ve(()=>w()),(u,o)=>{const f=t("v-number-input"),m=t("v-col"),p=t("v-btn"),C=t("v-row"),M=t("v-tab"),S=t("v-tabs"),B=t("v-text-field"),h=t("v-icon"),J=t("v-list"),L=t("v-tabs-window-item"),j=t("v-tabs-window"),E=t("v-card"),O=t("v-card-text"),W=t("v-divider"),Y=t("v-spacer"),X=t("v-card-actions");return P(),I(E,{"prepend-icon":"mdi-format-list-numbered",title:"Livelli"},{default:a(()=>[e(O,null,{default:a(()=>[e(C,{class:"my-3 mb-10 justify-center"},{default:a(()=>[e(m,{class:"px-2",cols:"12",md:"4"},{default:a(()=>[e(f,{"max-width":"500",modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=d=>V.value=d),reverse:!1,controlVariant:"default",label:"Fascia di Prezzo",prefix:"€",hideInput:!1,inset:!1,min:0},null,8,["modelValue"])]),_:1}),e(m,{class:"px-2",cols:"12",md:"1"},{default:a(()=>[e(p,{onClick:b,icon:"mdi-plus",color:"success"}),e(p,{onClick:U,icon:"mdi-minus",color:"error"})]),_:1})]),_:1}),v.value?(P(),I(E,{key:0,class:"mx-5 mt-5 pa-2",elevation:"3"},{default:a(()=>[e(S,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=d=>v.value=d),class:"my-2","align-tabs":"center",color:"primary","show-arrows":""},{default:a(()=>[(P(!0),se(ue,null,re(c.value,d=>(P(),I(M,{key:d.price,text:d.price+" €",value:d},null,8,["text","value"]))),128))]),_:1},8,["modelValue"]),e(j,{modelValue:v.value,"onUpdate:modelValue":o[3]||(o[3]=d=>v.value=d)},{default:a(()=>[(P(!0),se(ue,null,re(c.value,d=>(P(),I(L,{class:"mx-5 my-5",key:d.price,value:d},{default:a(()=>[e(B,{modelValue:_.value,"onUpdate:modelValue":o[2]||(o[2]=q=>_.value=q),label:"Nome Livello","append-icon":"mdi-plus",type:"text","onClick:append":q=>x(d)},null,8,["modelValue","onClick:append"]),e(J,{items:d.levels},{append:a(({item:q})=>[e(h,{size:"small",onClick:l=>g(d,q)},{default:a(()=>o[6]||(o[6]=[Ve(" mdi-delete ")])),_:2},1032,["onClick"])]),_:2},1032,["items"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):me("",!0)]),_:1}),e(W),e(X,null,{default:a(()=>[e(Y),e(p,{text:"Annulla",variant:"plain",onClick:o[4]||(o[4]=d=>k("close"))}),e(p,{color:"primary",text:"Salva Livelli",variant:"tonal",onClick:o[5]||(o[5]=d=>k("save",c.value))})]),_:1})]),_:1})}}}),Oe=le({__name:"ManagerEditor",props:{initialManagerOptions:{}},emits:["close","save"],setup(A,{emit:G}){const r=A,k=G,V=K({totalStudents:ee().required("Il Numero Totale degli Studenti è obbligatorio").positive().label("Numero Totale Studenti"),quotePerStudent:ee().required("La Quota per Studente è obbligatoria").positive().label("Quota per Studente"),cashFund:ee().positive().label("Fondo Cassa").nullable().optional()}),{defineField:_,handleSubmit:v}=pe({validationSchema:V}),c=m=>({props:{"error-messages":m.errors}}),[w,g]=_("totalStudents",c),[U,b]=_("quotePerStudent",c),[x,u]=_("cashFund",c),o=v(async m=>{k("save",{...m})},m=>{z.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(m)});ae(()=>r.initialManagerOptions,()=>f(),{immediate:!0});function f(){r.initialManagerOptions&&(w.value=r.initialManagerOptions.totalStudents,U.value=r.initialManagerOptions.quotePerStudent,x.value=r.initialManagerOptions.cashFund)}return(m,p)=>{const C=t("v-number-input"),M=t("v-col"),S=t("v-row"),B=t("v-card-text"),h=t("v-divider"),J=t("v-spacer"),L=t("v-btn"),j=t("v-card-actions"),E=t("v-card");return P(),I(E,{"prepend-icon":"mdi-account",title:"Gestione Scuola"},{default:a(()=>[e(B,null,{default:a(()=>[e(S,{class:"my-3 mb-10 justify-center"},{default:a(()=>[e(M,{cols:"12",md:"6"},{default:a(()=>[e(C,N({modelValue:s(w),"onUpdate:modelValue":p[0]||(p[0]=O=>R(w)?w.value=O:null)},s(g),{reverse:!1,controlVariant:"default",label:"Numero Totale Studenti",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(C,N({modelValue:s(U),"onUpdate:modelValue":p[1]||(p[1]=O=>R(U)?U.value=O:null)},s(b),{reverse:!1,controlVariant:"default",label:"Quota per Studente",prefix:"€",hideInput:!1,inset:!1,min:0}),null,16,["modelValue"])]),_:1}),e(M,{cols:"12",md:"6"},{default:a(()=>[e(C,N({modelValue:s(x),"onUpdate:modelValue":p[2]||(p[2]=O=>R(x)?x.value=O:null)},s(u),{reverse:!1,controlVariant:"default",label:"Fondo Cassa",hideInput:!1,prefix:"€",inset:!1,min:0}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h),e(j,null,{default:a(()=>[e(J),e(L,{text:"Annulla",variant:"plain",onClick:p[3]||(p[3]=O=>k("close"))}),e(L,{color:"primary",text:"Salva Gestione",variant:"tonal",onClick:s(o)},null,8,["onClick"])]),_:1})]),_:1})}}}),ke={class:"v-input--center-affix v-input--error"},we={class:"v-input__details"},Le={class:"v-messages__message v-messages",role:"alert"},Pe={class:"v-input--center-affix v-input--error"},Re={class:"v-input__details"},Ue={class:"v-messages__message v-messages",role:"alert"},Te=le({__name:"SchoolEditor",props:{initialSchool:{},edit:{type:Boolean}},emits:["close","save"],setup(A,{emit:G}){const r=A,k=G,V=F(!1),_=F(!1),v=F(!1),c=[{key:oe.ABSENT_AND_PRESENT,value:"La lezione viene pagata sia se lo studente è presente sia se è assente"},{key:oe.ONLY_PRESENT,value:"La lezione viene pagata solo se lo studente è presente"}],w=K({name:D().required("Il Nome è obbligatorio").min(1).label("Nome"),city:D().label("Città").nullable().optional(),email:D().label("Email").nullable().optional(),phoneNumber:D().label("Numero di Telefono").nullable().optional(),managed:xe().label("Gestione"),salaryStrategy:D().required("L'Opzione di pagamento lezioni è obbligatorio").label("Opzione di Pagamento"),managerOptions:K().test({test:l=>S.value?l!==void 0:!0,message:"Configurare la Gestione della Scuola correttamente",exclusive:!1,name:"managedProp"}).label("Opzioni Gestione"),levelRanges:Ne().of(K()).test({test:l=>!!l&&l.length!=0,message:"I livelli sono obbligatori; configurare correttamente i Livelli",exclusive:!1,name:"level"}).label("Livelli")}),{defineField:g,handleSubmit:U}=pe({validationSchema:w}),b=l=>({props:{"error-messages":l.errors}}),[x,u]=g("name",b),[o,f]=g("city",b),[m,p]=g("email",b),[C,M]=g("phoneNumber",b),[S,B]=g("managed",b),[h,J]=g("salaryStrategy",b),[L,j]=g("managerOptions",b),[E,O]=g("levelRanges",b),W=U(async l=>{q(l)},l=>{z.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(l)});ae(()=>r.initialSchool,()=>Y());function Y(){if(r.initialSchool){const l=JSON.parse(JSON.stringify(r.initialSchool));x.value=l.name,o.value=l.city??"",m.value=l.email??"",C.value=l.phoneNumber??"",h.value=l.salaryStrategy,S.value=l.managed,L.value=l.managerOptions,E.value=l.levelRanges}}function X(l){console.log(l,JSON.stringify(l)),L.value=l,_.value=!1}function d(l){console.log(l,JSON.stringify(l)),E.value=l,V.value=!1}async function q(l){var T,y;v.value=!0;const n={name:l.name,salaryStrategy:l.salaryStrategy,managed:S.value??!1,levelRanges:l.levelRanges,createdAt:r.edit?(T=r.initialSchool)==null?void 0:T.createdAt:de.now(),updatedAt:de.now()};l.city&&(n.city=l.city),l.email&&(n.email=l.email),l.phoneNumber&&(n.phoneNumber=l.phoneNumber),S.value&&(n.managerOptions=L.value);try{r.edit&&((y=r.initialSchool)==null?void 0:y.id)!=null?(await ie.instance.save(n,r.initialSchool.id),z.success("Scuola Aggiornata"),r.initialSchool.salaryStrategy!=null&&r.initialSchool.salaryStrategy!=n.salaryStrategy&&z.warning("E' stata aggiornata l'opzione di pagamento, tuttavia TUTTE le lezioni giornaliere create fino ad ora non saranno aggiornate in automatico!",{autoClose:1e4})):(await ie.instance.save(n),z.success("Scuola Creata")),k("save",n)}catch(Z){k("save"),z.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",Z)}finally{v.value=!1}}return ve(()=>Y()),(l,n)=>{const T=t("v-text-field"),y=t("v-col"),Z=t("v-select"),_e=t("v-checkbox"),H=t("v-btn"),te=t("v-dialog"),ne=t("v-row"),fe=t("v-card-text"),ge=t("v-divider"),be=t("v-spacer"),Se=t("v-card-actions"),ye=t("v-card");return P(),I(ye,{"prepend-icon":"mdi-school",title:"Scuola"},{default:a(()=>[e(fe,null,{default:a(()=>[e(ne,{dense:""},{default:a(()=>[e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,N({modelValue:s(x),"onUpdate:modelValue":n[0]||(n[0]=i=>R(x)?x.value=i:null)},s(u),{label:"Nome",required:""}),null,16,["modelValue"])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,N({modelValue:s(o),"onUpdate:modelValue":n[1]||(n[1]=i=>R(o)?o.value=i:null)},s(f),{label:"Città"}),null,16,["modelValue"])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,N({modelValue:s(m),"onUpdate:modelValue":n[2]||(n[2]=i=>R(m)?m.value=i:null)},s(p),{label:"Email"}),null,16,["modelValue"])]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(T,N({modelValue:s(C),"onUpdate:modelValue":n[3]||(n[3]=i=>R(C)?C.value=i:null)},s(M),{label:"Numero di Telefono"}),null,16,["modelValue"])]),_:1}),e(y,{cols:"12",md:"12"},{default:a(()=>[e(ne,{"justify-center":""},{default:a(()=>[e(y,{class:"align-self-center"},{default:a(()=>[e(Z,N({modelValue:s(h),"onUpdate:modelValue":n[4]||(n[4]=i=>R(h)?h.value=i:null)},s(J),{items:c,"item-title":"value","item-value":"key",label:"Opzione di Pagamento",required:""}),null,16,["modelValue"])]),_:1}),e(y,{class:"align-self-center"},{default:a(()=>[e(_e,N({modelValue:s(S),"onUpdate:modelValue":n[5]||(n[5]=i=>R(S)?S.value=i:null)},s(B),{label:"Gestione"}),null,16,["modelValue"])]),_:1}),e(y,{class:"align-self-center"},{default:a(()=>[s(S)?(P(),I(te,{key:0,modelValue:_.value,"onUpdate:modelValue":n[8]||(n[8]=i=>_.value=i),fullscreen:""},{activator:a(({props:i})=>{var Q;return[$("div",ke,[e(H,N({text:"Gestione"},i),null,16),$("div",we,[$("div",Le,[$("span",null,ce((Q=s(j)["error-messages"])==null?void 0:Q[0]),1)])])])]}),default:a(()=>[e(Oe,{initialManagerOptions:s(L),onClose:n[6]||(n[6]=i=>_.value=!1),onSave:n[7]||(n[7]=i=>X(i))},null,8,["initialManagerOptions"])]),_:1},8,["modelValue"])):me("",!0)]),_:1})]),_:1})]),_:1}),e(y,{cols:"12",md:"6"},{default:a(()=>[e(te,{modelValue:V.value,"onUpdate:modelValue":n[11]||(n[11]=i=>V.value=i),fullscreen:""},{activator:a(({props:i})=>{var Q;return[$("div",Pe,[e(H,N({text:"Gestisci Livelli"},i),null,16),$("div",Re,[$("div",Ue,[$("span",null,ce((Q=s(O)["error-messages"])==null?void 0:Q[0]),1)])])])]}),default:a(()=>[e(Ce,{initialLevelRanges:s(E),onClose:n[9]||(n[9]=i=>V.value=!1),onSave:n[10]||(n[10]=i=>d(i))},null,8,["initialLevelRanges"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(ge),e(Se,null,{default:a(()=>[e(be),e(H,{text:"Chiudi",variant:"plain",onClick:n[12]||(n[12]=i=>k("close"))}),e(H,{color:"primary",loading:v.value,disabled:v.value,text:l.edit?"Salva Modifiche":"Crea",variant:"tonal",onClick:s(W)},null,8,["loading","disabled","text","onClick"])]),_:1})]),_:1})}}});export{Te as _};

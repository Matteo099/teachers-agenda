import{d as Q,r as x,b as t,e as r,c as C,w as o,n as we,p as re,q as de,f as e,k as H,l as h,t as I,i as q,s as oe,u as ce,v as F,x as xe,y as ze,T as ie,o as ae,m as z,z as l,A as j,a as me,B as Ne,C as Ie,D as Re,j as G,E as ve,G as pe,g as $,h as te,F as X,H as _e,I as Me,J as $e}from"./index-ReAJFkyG.js";import{_ as Ee}from"./BackButton.vue_vue_type_script_setup_true_lang-CEXhIt5T.js";import{_ as Ue}from"./SchoolEditor.vue_vue_type_script_setup_true_lang-BFl3GlhA.js";import{d as Z,T as Oe,y as J,r as Pe,L as Te}from"./model-BjBmgxIT.js";import{S as ne,a as qe}from"./lesson-group-service-BtlVGGcN.js";import{u as fe}from"./vee-validate.esm-Bq4EpuXQ.js";import{u as ye,D as ge}from"./abstract-repository-DlvEjJ0c.js";import{S as le,L as Be,a as je}from"./LessonView-CJ7hW7dh.js";import"./school-repository-Ck4WOYWa.js";import"./DailyLessonCalendar-BvNxr8Y0.js";const be=Q({__name:"DeleteDialog",props:{objName:{default:"Oggetto"},useToast:{type:Boolean,default:!0},name:{},onDelete:{}},emits:["delete"],setup(E,{emit:O}){const i=E,c=x(!1),_=x(!1);async function y(){var a;_.value=!0;const g=await((a=i.onDelete)==null?void 0:a.call(i))??!1;i.useToast&&(g?q.success(`${i.objName} eliminato/a`):q.warning("Errore durante l'eliminazione")),_.value=!1,c.value=g}return(g,a)=>{const k=t("v-card-text"),R=t("v-btn"),s=t("v-spacer"),n=t("v-card-actions"),U=t("v-card"),m=t("v-dialog");return r(),C(m,{modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=w=>c.value=w)},{activator:o(({props:w})=>[we(g.$slots,"activator",re(de({props:w})))]),default:o(()=>[e(U,{"prepend-icon":"mdi-alert",class:"mx-auto","max-width":"500",title:"Elimina "+g.objName},{default:o(()=>[e(k,null,{default:o(()=>[H("p",null,[a[2]||(a[2]=h("Sei sicuro di voler eliminare ")),H("b",null,I(g.name),1),a[3]||(a[3]=h("?"))]),a[4]||(a[4]=H("br",null,null,-1)),a[5]||(a[5]=H("p",null,[h("Dopo avere eliminato la risorsa "),H("b",null,"NON"),h(" è più possibile recuperare i dati!")],-1))]),_:1}),e(n,null,{default:o(()=>[e(R,{text:"Annulla",onClick:a[0]||(a[0]=w=>c.value=!1)}),e(s),e(R,{color:"surface-variant",text:"Elimina",variant:"flat",onClick:y,loading:_.value},null,8,["loading"])]),_:1})]),_:1},8,["title"])]),_:3},8,["modelValue"])}}}),ue=Q({__name:"StudentEditor",props:{school:{},initialStudent:{},edit:{type:Boolean}},emits:["close","save"],setup(E,{emit:O}){const i=E,c=O,_=x(),y=x([]),g=x(!1);oe(()=>i.initialStudent,()=>Y()),oe(()=>i.school,()=>K());const a=ce({name:F().required("Il Nome è obbligatorio").min(1).label("Nome"),surname:F().required("Il Cognome è obbligatorio").min(1).label("Cognome"),contact:F().label("Contatto").nullable().optional(),lessonDay:F().label("Giono di Lezione").nullable().optional(),level:F().required("Il Livello è obbligatorio").label("Livello"),minutesLessonDuration:xe().required("La Durata della Lezione è obbligatoria").min(1).label("Durata della Lezione"),notes:ze().of(F()).label("Note")}),{defineField:k,handleSubmit:R}=fe({validationSchema:a}),s=f=>({props:{"error-messages":f.errors}}),[n,U]=k("name",s),[m,w]=k("surname",s),[N,P]=k("contact",s),[D,b]=k("lessonDay",s),[d,v]=k("level",s),[u,T]=k("minutesLessonDuration",s),[S,L]=k("notes",s),A=R(async f=>{ee(f)},f=>{q.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(f)});function Y(){if(i.initialStudent){const f=JSON.parse(JSON.stringify(i.initialStudent));n.value=f.name,m.value=f.surname??"",N.value=f.contact??"",D.value=Z[f.lessonDay],d.value=f.level,S.value=f.notes??[],u.value=f.minutesLessonDuration}}function K(){_.value=i.school,y.value=_.value.levelRanges.flatMap(f=>f.levels)}async function ee(f){var V,B;g.value=!0;const p={...f};p.schoolId=_.value.id,p.createdAt=i.edit?(V=i.initialStudent)==null?void 0:V.createdAt:ie.now(),p.updatedAt=ie.now(),D.value&&(p.lessonDay=Z.indexOf(D.value));try{i.edit&&((B=i.initialStudent)==null?void 0:B.id)!=null?(await ne.instance.save(p,i.initialStudent.id),q.success("Studente Aggiornato")):(await ne.instance.save(p),q.success("Studente Creato")),c("save",p)}catch(W){c("save"),q.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",W)}finally{g.value=!1}}return ae(()=>{Y(),K()}),(f,p)=>{const V=t("v-text-field"),B=t("v-col"),W=t("v-select"),Se=t("v-number-input"),Le=t("v-row"),Ve=t("v-card-text"),De=t("v-divider"),he=t("v-spacer"),se=t("v-btn"),ke=t("v-card-actions"),Ce=t("v-card");return r(),C(Ce,{"prepend-icon":"mdi-school",title:`Studente (${f.school.name})`},{default:o(()=>[e(Ve,null,{default:o(()=>[e(Le,{dense:""},{default:o(()=>[e(B,{cols:"12",md:"6"},{default:o(()=>[e(V,z({modelValue:l(n),"onUpdate:modelValue":p[0]||(p[0]=M=>j(n)?n.value=M:null)},l(U),{label:"Nome"}),null,16,["modelValue"])]),_:1}),e(B,{cols:"12",md:"6"},{default:o(()=>[e(V,z({modelValue:l(m),"onUpdate:modelValue":p[1]||(p[1]=M=>j(m)?m.value=M:null)},l(w),{label:"Cognome"}),null,16,["modelValue"])]),_:1}),e(B,{cols:"12",md:"6"},{default:o(()=>[e(V,z({modelValue:l(N),"onUpdate:modelValue":p[2]||(p[2]=M=>j(N)?N.value=M:null)},l(P),{label:"Contatto"}),null,16,["modelValue"])]),_:1}),e(B,{cols:"12",md:"6"},{default:o(()=>[e(W,z({modelValue:l(d),"onUpdate:modelValue":p[3]||(p[3]=M=>j(d)?d.value=M:null)},l(v),{items:y.value,label:"Livello"}),null,16,["modelValue","items"])]),_:1}),e(B,{cols:"12",md:"6"},{default:o(()=>[e(W,z({modelValue:l(D),"onUpdate:modelValue":p[4]||(p[4]=M=>j(D)?D.value=M:null)},l(b),{items:l(Z),label:"Giorno della Lezione"}),null,16,["modelValue","items"])]),_:1}),e(B,{cols:"12",md:"6"},{default:o(()=>[e(Se,z({modelValue:l(u),"onUpdate:modelValue":p[5]||(p[5]=M=>j(u)?u.value=M:null)},l(T),{reverse:!1,controlVariant:"default",label:"Durata della Lezione",suffix:"min",hideInput:!1,inset:!1,min:1}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(De),e(ke,null,{default:o(()=>[e(he),e(se,{text:"Chiudi",variant:"plain",onClick:p[6]||(p[6]=M=>c("close"))}),e(se,{color:"primary",loading:g.value,disabled:g.value,text:f.edit?"Salva Modifiche":"Crea",variant:"tonal",onClick:l(A)},null,8,["loading","disabled","text","onClick"])]),_:1})]),_:1},8,["title"])}}}),Ae=Q({__name:"StudentView",props:{school:{}},setup(E){const O=E,i=[],c=x([]),_=x(!1),y=x(!1),g=[{title:"Nome",align:"start",sortable:!0,key:"name"},{title:"Cognome",key:"surname"},{title:"Contatto",key:"contact"},{title:"Giorno della Lezione",key:"lessonDay"},{title:"Operazioni",key:"actions",sortable:!1}];function a(s){s&&(y.value=!1)}async function k(s){if(!s)return!1;try{return await ne.instance.delete(s.id),!0}catch{return!1}}async function R(){_.value=!0;const s=qe.instance.observeStudentsOfSchool(O.school.id).subscribe({next:n=>{c.value=n,_.value=!1},error:n=>_.value=!1});i.push(s)}return ae(async()=>{await R()}),me(()=>{i.forEach(s=>s.unsubscribe())}),(s,n)=>{const U=t("v-text-field"),m=t("v-btn"),w=t("v-dialog"),N=t("v-row"),P=t("v-icon"),D=t("v-data-table"),b=t("v-card-text"),d=t("v-card");return r(),C(d,{elevation:"3"},{default:o(()=>[e(b,null,{default:o(()=>[e(N,{class:"mr-4 mb-1 align-center"},{default:o(()=>[e(U,{class:"ma-2","prepend-inner-icon":"mdi-magnify",density:"comfortable",placeholder:"Ricerca...",theme:"light",variant:"solo","hide-details":""}),e(w,{modelValue:y.value,"onUpdate:modelValue":n[2]||(n[2]=v=>y.value=v),fullscreen:""},{activator:o(({props:v})=>[e(m,z({"prepend-icon":"mdi-plus",color:"success"},v),{default:o(()=>n[3]||(n[3]=[h("nuovo studente")])),_:2},1040)]),default:o(()=>[e(ue,{school:s.school,onClose:n[0]||(n[0]=v=>y.value=!1),onSave:n[1]||(n[1]=v=>a(v))},null,8,["school"])]),_:1},8,["modelValue"])]),_:1}),e(D,{headers:g,items:c.value,"item-value":"id"},{"item.lessonDay":o(({item:v})=>[h(I(l(Z)[v.lessonDay]),1)]),"item.actions":o(({item:v})=>[e(w,{fullscreen:""},{activator:o(({props:u})=>[e(P,z({class:"me-2",size:"small"},u),{default:o(()=>n[4]||(n[4]=[h(" mdi-pencil ")])),_:2},1040)]),default:o(({isActive:u})=>[e(ue,{edit:"",school:s.school,initialStudent:v,onClose:T=>u.value=!1,onSave:T=>u.value=!1},null,8,["school","initialStudent","onClose","onSave"])]),_:2},1024),e(be,{name:v.name+" "+v.surname,objName:"Studente",onDelete:async()=>await k(v)},{activator:o(({props:u})=>[e(P,z({size:"small"},u),{default:o(()=>n[5]||(n[5]=[h(" mdi-delete ")])),_:2},1040)]),_:2},1032,["name","onDelete"])]),_:1},8,["items"])]),_:1})]),_:1})}}}),Fe=Q({__name:"ScheduleRecoveryLessonButton",props:Ne({school:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(E){const O=E,i=Ie(E,"modelValue"),c=x(!1),_=x(!1),y=x(!1),g=ce({date:Re().required("La Data della Lezione di Recupero è obbligatoria").label("Data della Lezione di Recupero"),time:F().required("L'Orario della Lezione di Recupero è obbligatorio").label("Orario della Lezione di Recupero")}),{defineField:a,handleSubmit:k,resetForm:R}=fe({validationSchema:g}),s=b=>({props:{"error-messages":b.errors}}),[n,U]=a("date",s),[m,w]=a("time",s),N=k(async b=>{D()},b=>{q.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(b)});function P(){_.value=!1,n.value=void 0,m.value=void 0,R()}async function D(){if(!(!n.value||!m.value||!i.value))try{y.value=!0;const b=Oe.fromHHMM(m.value),d={studentId:i.value.studentId,schoolId:O.school.id,originalDailyLessonId:i.value.originalDailyLesson.id,originalLessonId:i.value.lessonId,date:n.value,startTime:b.toITime(),endTime:b.add({minutes:i.value.minutesLessonDuration}).toITime()};await le.instance.scheduleRecovery(i.value,d),_.value=!1}catch{q.error("Impossibile schedulare la lezione di recupero")}finally{y.value=!1}}return(b,d)=>{const v=t("v-btn"),u=t("v-date-input"),T=t("v-col"),S=t("v-time-picker"),L=t("v-dialog"),A=t("v-text-field"),Y=t("v-row"),K=t("v-card-text"),ee=t("v-spacer"),f=t("v-card-actions"),p=t("v-card");return r(),C(L,{modelValue:_.value,"onUpdate:modelValue":d[5]||(d[5]=V=>_.value=V),width:"auto",scrollable:"",persistent:""},{activator:o(({props:V})=>[e(v,re(de(V)),{default:o(()=>d[6]||(d[6]=[h("programma")])),_:2},1040)]),default:o(()=>[e(p,{title:"Programma Lezione di Recupero",subtitle:i.value.name+" "+i.value.surname+" - "+l(J).fromIyyyyMMdd(i.value.originalDailyLesson.date).format(),loading:y.value},{default:o(()=>[e(K,{class:"pa-6"},{default:o(()=>[e(Y,null,{default:o(()=>[e(T,{cols:"12",md:"12"},{default:o(()=>[e(u,z({modelValue:l(n),"onUpdate:modelValue":d[0]||(d[0]=V=>j(n)?n.value=V:null)},l(U),{label:"Data della Lezione di Recupero",inputmode:"none"}),null,16,["modelValue"])]),_:1}),e(T,{cols:"12",lg:"12"},{default:o(()=>[e(A,z({modelValue:l(m),"onUpdate:modelValue":d[3]||(d[3]=V=>j(m)?m.value=V:null)},l(w),{active:c.value,focused:c.value,inputmode:"none",label:"Orario della prima Lezione","prepend-icon":"mdi-clock-time-four-outline",readonly:""}),{default:o(()=>[e(L,{modelValue:c.value,"onUpdate:modelValue":d[2]||(d[2]=V=>c.value=V),activator:"parent",width:"auto"},{default:o(()=>[c.value?(r(),C(S,{key:0,modelValue:l(m),"onUpdate:modelValue":d[1]||(d[1]=V=>j(m)?m.value=V:null),format:"24hr"},null,8,["modelValue"])):G("",!0)]),_:1},8,["modelValue"])]),_:1},16,["modelValue","active","focused"])]),_:1})]),_:1})]),_:1}),e(f,null,{default:o(()=>[e(ee),e(v,{text:"Annulla",onClick:P}),e(v,{color:"primary",text:"Salva",onClick:d[4]||(d[4]=V=>l(N)(V))})]),_:1})]),_:1},8,["subtitle","loading"])]),_:1},8,["modelValue"])}}}),He={key:0},Ge={key:1},Je={key:2},Qe={key:0},Ye={key:1},Ke={key:0},We={key:2},Xe={key:0},Ze=Q({__name:"RecoveryLessonView",props:{school:{}},setup(E){const O=E,i=ye(ge.SCHOOL_RECOVERY_LESSONS),c=x(),_=x(!1),y=x(!1),g=ve(()=>_e(i,O.school.id)),a=pe(g);oe(a,async()=>R());async function k(s){try{y.value=!0,await le.instance.cancelRecovery(s)}catch{q.warn("Impossibile annullare la lezione di recupero")}finally{y.value=!1}}async function R(){if(a.value)try{_.value=!0,c.value=await le.instance.computeDailyLessons(a.value),console.log(c)}catch{q.warning("Impossibile caricare le Lezioni di Recupero")}finally{_.value=!1}}return(s,n)=>{const U=t("v-list-subheader"),m=t("v-list-item"),w=t("v-btn"),N=t("v-icon"),P=t("v-divider"),D=t("v-list"),b=t("v-card-text"),d=t("v-card");return r(),C(d,{title:"Recuperi",elevation:"3",loading:_.value},{default:o(()=>[e(D,{lines:"three"},{default:o(()=>{var v;return[(r(!0),$(X,null,te((v=c.value)==null?void 0:v.recoveryMap,(u,T)=>(r(),$(X,{key:u.type},[e(U,{inset:""},{default:o(()=>[H("b",null,I(l(Pe)[u.type]),1)]),_:2},1024),u.recoveries.length==0?(r(),C(m,{key:0},{default:o(()=>[u.type=="unset"?(r(),$("div",He," Nessuna lezione da recuperare ")):u.type=="pending"?(r(),$("div",Ge," Nessuna lezione di recupero programmata ")):(r(),$("div",Je," Nessuna lezione di recupero effettuata "))]),_:2},1024)):G("",!0),(r(!0),$(X,null,te(u.recoveries,(S,L)=>(r(),C(m,{key:`${S.lessonId}_${S.originalDailyLesson.id}`},{title:o(()=>[h(I(S.name)+" "+I(S.surname),1)]),subtitle:o(()=>[u.type=="unset"?(r(),$("div",Qe," Da recuperare la lezione del "+I(l(J).fromIyyyyMMdd(S.originalDailyLesson.date).format()),1)):u.type=="pending"?(r(),$("div",Ye,[h(" Recupero della lezione del "+I(l(J).fromIyyyyMMdd(S.originalDailyLesson.date).format())+" programmato ",1),S.recoveryDailyLesson?(r(),$("span",Ke," per il "+I(l(J).fromIyyyyMMdd(S.recoveryDailyLesson.date).format()),1)):G("",!0)])):(r(),$("div",We,[h(" Recupero della lezione del "+I(l(J).fromIyyyyMMdd(S.originalDailyLesson.date).format())+" effettuato ",1),S.recoveryDailyLesson?(r(),$("span",Xe," il "+I(l(J).fromIyyyyMMdd(S.recoveryDailyLesson.date).format()),1)):G("",!0)]))]),append:o(()=>[u.type=="unset"?(r(),C(Fe,{key:0,modelValue:u.recoveries[L],"onUpdate:modelValue":A=>u.recoveries[L]=A,school:s.school},null,8,["modelValue","onUpdate:modelValue","school"])):u.type=="pending"?(r(),C(w,{key:1,onClick:A=>k(S),loading:y.value,disabled:y.value},{default:o(()=>n[0]||(n[0]=[h("annulla")])),_:2},1032,["onClick","loading","disabled"])):S.recoveryStatus==l(Te).CANCELLED?(r(),C(N,{key:2,color:"warning"},{default:o(()=>n[1]||(n[1]=[h(" mdi-cancel ")])),_:1})):(r(),C(N,{key:3,color:"success"},{default:o(()=>n[2]||(n[2]=[h(" mdi-check-all ")])),_:1}))]),_:2},1024))),128)),T!=2?(r(),C(P,{key:1})):G("",!0)],64))),128))]}),_:1}),c.value?G("",!0):(r(),C(b,{key:0},{default:o(()=>n[3]||(n[3]=[h(" Nessun recupero in programma ")])),_:1}))]),_:1},8,["loading"])}}}),co=Q({__name:"SchoolView",setup(E){const O=Me(),i=$e(),c=ye(ge.SCHOOLS),_=[],y=x([]),g=ve(()=>_e(c,O.params.id)),a=pe(g);async function k(){if(!a.value)return!1;try{return je.instance.delete(g.value),i.push("/"),!0}catch{return!1}}async function R(){const s=[{id:0,title:"Questa è una nota molto carina e paffutella",description:"",student:"Matteo Rossi"},{id:1,title:"Questa è una nota con descrizione",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut viverra tincidunt risus sit amet interdum. Nam sed leo id ipsum efficitur congue nec ut est. Nullam in metus leo. In commodo, leo eu vulputate euismod, urna lacus efficitur nibh, ut maximus felis metus eu odio. Duis cursus commodo auctor. Suspendisse condimentum lorem dui, id tristique lectus commodo nec.",student:"Luca Verdi"}];y.value=s}return ae(async()=>{await R()}),me(()=>{_.forEach(s=>s())}),(s,n)=>{const U=t("v-btn"),m=t("v-list-item"),w=t("v-dialog"),N=t("v-list"),P=t("v-menu"),D=t("v-col"),b=t("v-row"),d=t("v-expansion-panel-title"),v=t("v-expansion-panel-text"),u=t("v-expansion-panel"),T=t("v-expansion-panels"),S=t("v-card");return l(a)?(r(),C(S,{key:0,class:"pa-3",title:l(a).name,elevation:"0"},{prepend:o(()=>[e(Ee)]),append:o(()=>[e(P,{transition:"slide-y-transition"},{activator:o(({props:L})=>[e(U,z({icon:"mdi-dots-vertical",variant:"text"},L),null,16)]),default:o(()=>[e(N,null,{default:o(()=>[e(w,{fullscreen:""},{activator:o(({props:L})=>[e(m,z({title:"Modifica"},L),null,16)]),default:o(({isActive:L})=>[e(Ue,{edit:"",initialSchool:l(a),onClose:A=>L.value=!1,onSave:A=>L.value=!1},null,8,["initialSchool","onClose","onSave"])]),_:1}),e(be,{name:l(a).name,objName:"Scuola",onDelete:k},{activator:o(({props:L})=>[e(m,z({title:"Elimina"},L),null,16)]),_:1},8,["name"])]),_:1})]),_:1})]),default:o(()=>[e(b,{class:"mt-5"},{default:o(()=>[e(D,{class:"pa-2",cols:"12",md:"6"},{default:o(()=>[e(Be,{school:l(a)},null,8,["school"])]),_:1}),e(D,{class:"pa-2",cols:"12",md:"6"},{default:o(()=>[e(Ze,{school:l(a)},null,8,["school"])]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(D,{class:"pa-2",cols:"12",md:"6"},{default:o(()=>[e(Ae,{school:l(a)},null,8,["school"])]),_:1})]),_:1}),e(b,null,{default:o(()=>[e(D,{class:"pa-2",cols:"12"},{default:o(()=>[e(S,{title:"Note",elevation:"3"},{default:o(()=>[e(T,null,{default:o(()=>[(r(!0),$(X,null,te(y.value,L=>(r(),C(u,{key:L.id},{default:o(()=>[e(d,null,{default:o(()=>[e(b,{"no-gutters":""},{default:o(()=>[e(D,{class:"d-flex justify-start",cols:"8"},{default:o(()=>[h(I(L.title),1)]),_:2},1024),e(D,{class:"text-grey",cols:"4"},{default:o(()=>[H("span",null,I(L.student),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(v,null,{default:o(()=>[h(I(L.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])):G("",!0)}}});export{co as default};

import{_ as Ie,W as Ye,D as Ze,S as We,a as Ve,b as et}from"./school-service-BCCyfghY.js";import{S as we,a as Me,W as Ce,v as tt,_ as ot}from"./v4-DJrres8J.js";import{_ as nt}from"./SchoolEditor.vue_vue_type_script_setup_true_lang-tBjb8FJu.js";import{d as oe,y as F,T as le,r as lt,L as at}from"./schedule-x-vue-xe1pV1oS.js";import{d as ue,r as k,n as Z,i as te,T as Le,o as ve,b as o,e as r,c as N,w as t,f as e,m as W,u as a,p as J,a as fe,l as P,t as R,q as _e,k as ae,j as ee,g as q,s as Re,v as st,h as de,F as ie,x as it,y as Ee,z as ut,A as rt,B as dt,C as ct,D as mt,E as Pe,G as vt}from"./index-DN_KyrT2.js";import{c as Te,a as se,b as pt,d as qe,u as $e,e as Se}from"./index.esm-DLOSFJjU.js";import{S as _t}from"./school-repository-BUMs1sJj.js";import{D as ft,_ as yt}from"./DailyLessonCalendar-D54ud3yg.js";import{L as gt}from"./lesson-group-service-D5zqBF55.js";const Oe=ue({__name:"StudentEditor",props:{school:{},initialStudent:{},edit:{type:Boolean}},emits:["close","save"],setup(A,{emit:H}){const g=A,S=H,I=k(),y=k([]),c=k(!1);Z(()=>g.initialStudent,()=>ne()),Z(()=>g.school,()=>Q());const O=Te({name:se().required("Il Nome è obbligatorio").min(1).label("Nome"),surname:se().required("Il Cognome è obbligatorio").min(1).label("Cognome"),contact:se().label("Contatto").nullable().optional(),lessonDay:se().label("Giono di Lezione").nullable().optional(),level:se().required("Il Livello è obbligatorio").label("Livello"),minutesLessonDuration:pt().required("La Durata della Lezione è obbligatoria").min(1).label("Durata della Lezione"),notes:qe().of(se()).label("Note")}),{defineField:M,handleSubmit:x}=$e({validationSchema:O}),d=T=>({props:{"error-messages":T.errors}}),[u,G]=M("name",d),[w,b]=M("surname",d),[l,f]=M("contact",d),[v,C]=M("lessonDay",d),[p,D]=M("level",d),[m,j]=M("minutesLessonDuration",d),[h,$]=M("notes",d),U=x(async T=>{K(T)},T=>{te.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(T)});function ne(){if(g.initialStudent){const T=JSON.parse(JSON.stringify(g.initialStudent));u.value=T.name,w.value=T.surname??"",l.value=T.contact??"",v.value=oe[T.lessonDay],p.value=T.level,h.value=T.notes??[],m.value=T.minutesLessonDuration}}function Q(){I.value=g.school,y.value=I.value.levelRanges.flatMap(T=>T.levels)}async function K(T){var i,V;c.value=!0;const s={...T};s.schoolId=I.value.id,s.createdAt=g.edit?(i=g.initialStudent)==null?void 0:i.createdAt:Le.now(),s.updatedAt=Le.now(),v.value&&(s.lessonDay=oe.indexOf(v.value));try{g.edit&&((V=g.initialStudent)==null?void 0:V.id)!=null?(await we.instance.save(s,g.initialStudent.id),te.success("Studente Aggiornato")):(await we.instance.save(s),te.success("Studente Creato")),S("save",s)}catch(re){S("save"),te.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",re)}finally{c.value=!1}}return ve(()=>{ne(),Q()}),(T,s)=>{const i=o("v-text-field"),V=o("v-col"),re=o("v-select"),ye=o("v-number-input"),he=o("v-row"),ge=o("v-card-text"),pe=o("v-divider"),ke=o("v-spacer"),ce=o("v-btn"),xe=o("v-card-actions"),De=o("v-card");return r(),N(De,{"prepend-icon":"mdi-school",title:`Studente (${T.school.name})`},{default:t(()=>[e(ge,null,{default:t(()=>[e(he,{dense:""},{default:t(()=>[e(V,{cols:"12",md:"6"},{default:t(()=>[e(i,W({modelValue:a(u),"onUpdate:modelValue":s[0]||(s[0]=B=>J(u)?u.value=B:null)},a(G),{label:"Nome"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(i,W({modelValue:a(w),"onUpdate:modelValue":s[1]||(s[1]=B=>J(w)?w.value=B:null)},a(b),{label:"Cognome"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(i,W({modelValue:a(l),"onUpdate:modelValue":s[2]||(s[2]=B=>J(l)?l.value=B:null)},a(f),{label:"Contatto"}),null,16,["modelValue"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(re,W({modelValue:a(p),"onUpdate:modelValue":s[3]||(s[3]=B=>J(p)?p.value=B:null)},a(D),{items:y.value,label:"Livello"}),null,16,["modelValue","items"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(re,W({modelValue:a(v),"onUpdate:modelValue":s[4]||(s[4]=B=>J(v)?v.value=B:null)},a(C),{items:a(oe),label:"Giorno della Lezione"}),null,16,["modelValue","items"])]),_:1}),e(V,{cols:"12",md:"6"},{default:t(()=>[e(ye,W({modelValue:a(m),"onUpdate:modelValue":s[5]||(s[5]=B=>J(m)?m.value=B:null)},a(j),{reverse:!1,controlVariant:"default",label:"Durata della Lezione",suffix:"min",hideInput:!1,inset:!1,min:1}),null,16,["modelValue"])]),_:1})]),_:1})]),_:1}),e(pe),e(xe,null,{default:t(()=>[e(ke),e(ce,{text:"Chiudi",variant:"plain",onClick:s[6]||(s[6]=B=>S("close"))}),e(ce,{color:"primary",loading:c.value,disabled:c.value,text:T.edit?"Salva Modifiche":"Crea",variant:"tonal",onClick:a(U)},null,8,["loading","disabled","text","onClick"])]),_:1})]),_:1},8,["title"])}}}),bt=ue({__name:"StudentView",props:{school:{}},setup(A){const H=A,g=[],S=k([]),I=k(!1),y=k(!1),c=[{title:"Nome",align:"start",sortable:!0,key:"name"},{title:"Cognome",key:"surname"},{title:"Contatto",key:"contact"},{title:"Giorno della Lezione",key:"lessonDay"},{title:"Operazioni",key:"actions",sortable:!1}];function O(d){d&&(y.value=!1)}async function M(d){if(!d)return!1;try{return await we.instance.delete(d.id),!0}catch{return!1}}async function x(){I.value=!0;const d=Me.instance.observeStudentsOfSchool(H.school.id).subscribe({next:u=>{S.value=u,I.value=!1},error:u=>I.value=!1});g.push(d)}return ve(async()=>{await x()}),fe(()=>{g.forEach(d=>d.unsubscribe())}),(d,u)=>{const G=o("v-text-field"),w=o("v-btn"),b=o("v-dialog"),l=o("v-row"),f=o("v-icon"),v=o("v-data-table"),C=o("v-card-text"),p=o("v-card");return r(),N(p,{elevation:"3"},{default:t(()=>[e(C,null,{default:t(()=>[e(l,{class:"mr-4 mb-1 align-center"},{default:t(()=>[e(G,{class:"ma-2","prepend-inner-icon":"mdi-magnify",density:"comfortable",placeholder:"Ricerca...",theme:"light",variant:"solo","hide-details":""}),e(b,{modelValue:y.value,"onUpdate:modelValue":u[2]||(u[2]=D=>y.value=D),fullscreen:""},{activator:t(({props:D})=>[e(w,W({"prepend-icon":"mdi-plus",color:"success"},D),{default:t(()=>u[3]||(u[3]=[P("nuovo studente")])),_:2},1040)]),default:t(()=>[e(Oe,{school:d.school,onClose:u[0]||(u[0]=D=>y.value=!1),onSave:u[1]||(u[1]=D=>O(D))},null,8,["school"])]),_:1},8,["modelValue"])]),_:1}),e(v,{headers:c,items:S.value,"item-value":"id"},{"item.lessonDay":t(({item:D})=>[P(R(a(oe)[D.lessonDay]),1)]),"item.actions":t(({item:D})=>[e(b,{fullscreen:""},{activator:t(({props:m})=>[e(f,W({class:"me-2",size:"small"},m),{default:t(()=>u[4]||(u[4]=[P(" mdi-pencil ")])),_:2},1040)]),default:t(({isActive:m})=>[e(Oe,{edit:"",school:d.school,initialStudent:D,onClose:j=>m.value=!1,onSave:j=>m.value=!1},null,8,["school","initialStudent","onClose","onSave"])]),_:2},1024),e(Ie,{name:D.name+" "+D.surname,objName:"Studente",onDelete:async()=>await M(D)},{activator:t(({props:m})=>[e(f,W({size:"small"},m),{default:t(()=>u[5]||(u[5]=[P(" mdi-delete ")])),_:2},1040)]),_:2},1032,["name","onDelete"])]),_:1},8,["items"])]),_:1})]),_:1})}}}),St={key:1,class:"text-grey text-caption align-self-center"},Ue=ue({__name:"WeekLessonEditor",props:{school:{default:()=>({id:"1"})},edit:{type:Boolean},initialWeekLesson:{}},emits:["close","save"],setup(A,{emit:H}){const g=H,S=A,I=[];let y;const c=k([]),O=k([]),M=k([]),x=k([]),d=k(!1),u=k(!1),G=k(!1),w=Te({dayOfWeek:se().required("Il Giorno è obbligatorio").label("Giorno"),from:Se().required("La Data di Inizio delle lezioni settimanali è obbligatoria").label("Dal"),to:Se().required("La Data di Fine delle lezioni settimanali è obbligatoria").label("Al"),excludeDates:qe().of(Se()).label("Giorni da Escludere").nullable().optional(),startingTime:se().required("L'Orario della prima Lezione è obbligatorio").label("Orario della prima Lezione")}),{defineField:b,handleSubmit:l}=$e({validationSchema:w}),f=_=>({props:{"error-messages":_.errors}}),[v,C]=b("dayOfWeek",f),[p,D]=b("from",f),[m,j]=b("to",f),[h,$]=b("excludeDates",f),[U,ne]=b("startingTime",f);let Q=!1;const K=k([]),T=l(async _=>{ke()},_=>{te.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(_)});Z(()=>S.initialWeekLesson,()=>ge()),Z(v,()=>pe()),Z(p,()=>pe()),Z(m,()=>pe()),Z(x,()=>re()),Z(U,()=>{ye(),Q=!1}),Z(v,async()=>await B()),Z(K,()=>he(),{deep:!0});const s=_e(()=>x.value.length===M.value.length),i=_e(()=>x.value.length>0);function V(){s.value?x.value=[]:x.value=M.value.slice()}function re(){var _;for(const n of x.value)if(c.value.findIndex(z=>z.studentId===n.id)===-1){const z=c.value.reduce((me,be)=>be.endTime>me?be.endTime:me,((_=le.fromHHMM(U.value))==null?void 0:_.getTotalMinutes())??0),X=n.minutesLessonDuration||0,Y=z+X*60;c.value.push({lessonId:tt(),studentId:n.id,startTime:z,endTime:Y})}for(const n of[...c.value])if(x.value.findIndex(z=>z.id==n.studentId)==-1){const z=c.value.indexOf(n);c.value.splice(z,1)}ye()}function ye(){var n;if(!Q&&c.value.length>0){c.value.sort((X,Y)=>X.startTime-Y.startTime);const z=(((n=le.fromHHMM(U.value))==null?void 0:n.getTotalMinutes())??0)*60-c.value[0].startTime;c.value.forEach(X=>{X.startTime+=z,X.endTime+=z})}const _=F.today();K.value=c.value.map(L=>{const z=ce(L.studentId);return{id:L.lessonId,start:_.toIyyyyMMdd("-")+" "+le.fromITime(L.startTime).format(),end:_.toIyyyyMMdd("-")+" "+le.fromITime(L.endTime).format(),title:`${xe(L.studentId)} - ${De(L.studentId)}`,data:{...L,...z}}})}function he(){c.value=K.value.map(_=>{const n=_.start.split(" ")[1],L=_.end.split(" ")[1];return{lessonId:_.data.lessonId,startTime:le.fromHHMM(n).toITime(),endTime:le.fromHHMM(L).toITime(),studentId:_.data.studentId}})}function ge(){if(S.initialWeekLesson){const _=JSON.parse(JSON.stringify(S.initialWeekLesson));v.value=oe[_.dayOfWeek],p.value=F.fromIyyyyMMdd(_.from).toDate(),m.value=F.fromIyyyyMMdd(_.to).toDate(),h.value=_.exclude.map(L=>F.fromIyyyyMMdd(L).toDate()),c.value=_.schedule;const n=c.value.map(L=>L.studentId);if(x.value=M.value.filter(L=>n.includes(L.id)),c.value.length>0){Q=!0;const L=c.value[0].startTime;U.value=le.fromITime(L).format()}}}function pe(){if(v.value===void 0||p.value===void 0||m.value===void 0)return;O.value=[];const _=oe.indexOf(v.value);let n=new Date(p.value);for(;n<=m.value;){if(n.getDay()===_){const L=new Date(n);O.value.push({name:st(L),value:L})}n.setDate(n.getDate()+1)}}async function ke(_){var L,z,X;u.value=!0;const n={schoolId:S.school.id,dayOfWeek:oe.indexOf(v.value),from:F.fromDate(p.value).toIyyyyMMdd(),to:F.fromDate(m.value).toIyyyyMMdd(),exclude:((L=h.value)==null?void 0:L.map(Y=>F.fromDate(Y).toIyyyyMMdd()))??[],schedule:c.value.sort((Y,me)=>Y.startTime-me.startTime),createdAt:S.edit?(z=S.initialWeekLesson)==null?void 0:z.createdAt:Le.now(),updatedAt:Le.now()};try{S.edit&&((X=S.initialWeekLesson)==null?void 0:X.id)!=null?(await Ce.instance.save(n,S.initialWeekLesson.id),te.success("Lezione Settimanale Aggiornata")):(await Ce.instance.save(n),te.success("Lezione Settimanale Creata")),g("save",n)}catch(Y){g("save"),te.error("Errore durante il salvataggio"),console.error("Error adding document (schools): ",Y)}finally{u.value=!1}}function ce(_){return M.value.find(n=>n.id==_)}function xe(_){let n;return typeof _=="string"?n=ce(_):n=_,`${n==null?void 0:n.name} ${n==null?void 0:n.surname}`}function De(_){let n;return typeof _=="string"?n=ce(_):n=_,oe[(n==null?void 0:n.lessonDay)??0]}async function B(){y==null||y.unsubscribe(),G.value=!0;const _=new Promise((n,L)=>{y=Me.instance.observeStudentsOfSchool(S.school.id).subscribe({next:z=>{M.value=z,G.value=!1,n()},error:z=>{G.value=!1,L(z)}})});I.push(y),await _}return fe(()=>{I.forEach(_=>_.unsubscribe())}),ve(async()=>{await B(),ge()}),(_,n)=>{const L=o("v-select"),z=o("v-col"),X=o("v-row"),Y=o("v-date-input"),me=o("v-chip"),be=o("v-time-picker"),Ge=o("v-dialog"),je=o("v-text-field"),Ae=o("v-checkbox-btn"),He=o("v-list-item"),Be=o("v-divider"),Fe=o("v-form"),Je=o("v-card-text"),Qe=o("v-spacer"),ze=o("v-btn"),Ke=o("v-card-actions"),Xe=o("v-card");return r(),N(Xe,{title:"Lezione Settimanale"},{default:t(()=>[e(Je,null,{default:t(()=>[e(Fe,{class:"ma-2"},{default:t(()=>[e(X,{class:"my-1 justify-center"},{default:t(()=>[e(z,{class:"px-2"},{default:t(()=>[e(L,W({modelValue:a(v),"onUpdate:modelValue":n[0]||(n[0]=E=>J(v)?v.value=E:null)},a(C),{items:a(oe),label:"Giorno",required:""}),null,16,["modelValue","items"])]),_:1})]),_:1}),e(X,{class:"my-1 justify-center"},{default:t(()=>[e(z,{class:"px-2",cols:"12",md:"4"},{default:t(()=>[e(Y,W({max:a(m),modelValue:a(p),"onUpdate:modelValue":n[1]||(n[1]=E=>J(p)?p.value=E:null)},a(D),{label:"Dal",inputmode:"none"}),null,16,["max","modelValue"])]),_:1}),e(z,{class:"px-2",cols:"12",md:"4"},{default:t(()=>[e(Y,W({min:a(p),modelValue:a(m),"onUpdate:modelValue":n[2]||(n[2]=E=>J(m)?m.value=E:null)},a(j),{label:"Al",inputmode:"none"}),null,16,["min","modelValue"])]),_:1}),e(z,{class:"px-2",cols:"12",md:"4"},{default:t(()=>[e(L,W({modelValue:a(h),"onUpdate:modelValue":n[3]||(n[3]=E=>J(h)?h.value=E:null)},a($),{items:O.value,label:"Giorni da Escludere",multiple:"","item-title":"name","item-value":"value","no-data-text":"Nessuna Data Disponibile",clearable:""}),{selection:t(({item:E,index:Ne})=>[Ne<2?(r(),N(me,{key:0},{default:t(()=>[ae("span",null,R(E.title),1)]),_:2},1024)):ee("",!0),Ne===2?(r(),q("span",St," (+"+R(a(h).length-2)+" others) ",1)):ee("",!0)]),_:1},16,["modelValue","items"])]),_:1})]),_:1}),e(X,{class:"my-1 justify-center"},{default:t(()=>[e(z,{class:"px-2",cols:"12",md:"6"},{default:t(()=>[e(je,W({modelValue:a(U),"onUpdate:modelValue":n[6]||(n[6]=E=>J(U)?U.value=E:null)},a(ne),{active:d.value,focused:d.value,inputmode:"none",label:"Orario della prima Lezione","prepend-icon":"mdi-clock-time-four-outline",readonly:""}),{default:t(()=>[e(Ge,{modelValue:d.value,"onUpdate:modelValue":n[5]||(n[5]=E=>d.value=E),activator:"parent",width:"auto"},{default:t(()=>[d.value?(r(),N(be,{key:0,modelValue:a(U),"onUpdate:modelValue":n[4]||(n[4]=E=>J(U)?U.value=E:null),format:"24hr"},null,8,["modelValue"])):ee("",!0)]),_:1},8,["modelValue"])]),_:1},16,["modelValue","active","focused"])]),_:1}),e(z,{class:"px-2",cols:"12",md:"6"},{default:t(()=>[e(L,{modelValue:x.value,"onUpdate:modelValue":n[7]||(n[7]=E=>x.value=E),items:M.value,label:"Studenti","item-title":"name","item-value":"id","return-object":!0,multiple:"","no-data-text":"Nessuno studente disponibile per questa scuola"},Re({_:2},[M.value.length>1?{name:"prepend-item",fn:t(()=>[e(He,{title:"Seleziona tutti",onClick:V},{prepend:t(()=>[e(Ae,{color:i.value?"indigo-darken-4":void 0,indeterminate:i.value&&!s.value,"model-value":s.value},null,8,["color","indeterminate","model-value"])]),_:1}),e(Be,{class:"mt-2"})]),key:"0"}:void 0]),1032,["modelValue","items"])]),_:1})]),_:1})]),_:1}),e(ft,{modelValue:K.value,"onUpdate:modelValue":n[8]||(n[8]=E=>K.value=E),editable:""},null,8,["modelValue"])]),_:1}),e(Ke,null,{default:t(()=>[e(Qe),e(ze,{text:"Chiudi",onClick:n[9]||(n[9]=E=>g("close"))}),e(ze,{text:"Salva",color:"primary",onClick:a(T),loading:u.value},null,8,["onClick","loading"])]),_:1})]),_:1})}}}),Lt={key:1},ht=ue({__name:"CalendarLessonEditor",props:{school:{}},emits:["close"],setup(A,{emit:H}){const g=A,S=H,I=[],y=k([]),c=k(!1),O=k(!1),M=k([]),x=k(!1);async function d(b){if(!b)return!1;try{return await Ce.instance.delete(b.id),!0}catch{return!1}}async function u(){c.value=!0;const b=Ye.instance.observeWeekLessonOfSchool(g.school.id).subscribe({next:l=>{y.value=l,c.value=!1},error:l=>c.value=!1});I.push(b)}async function G(){O.value=!0;const b=Me.instance.observeStudentsOfSchool(g.school.id).subscribe({next:l=>{M.value=l,O.value=!1},error:l=>O.value=!1});I.push(b)}function w(b){const l=M.value.find(f=>f.id==b);return`${l==null?void 0:l.name} ${l==null?void 0:l.surname}`}return ve(async()=>{await G(),await u()}),fe(()=>{I.forEach(b=>b.unsubscribe())}),(b,l)=>{const f=o("v-btn"),v=o("v-dialog"),C=o("v-col"),p=o("v-row"),D=o("v-expansion-panel-title"),m=o("v-list-item"),j=o("v-list"),h=o("v-expansion-panel-text"),$=o("v-expansion-panel"),U=o("v-expansion-panels"),ne=o("v-card-text"),Q=o("v-spacer"),K=o("v-card-actions"),T=o("v-card");return r(),N(T,{title:"Calendario",loading:c.value||O.value},{append:t(()=>[e(v,{modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=s=>x.value=s),transition:"dialog-bottom-transition",fullscreen:""},{activator:t(({props:s})=>[e(f,W({icon:"mdi-plus"},s,{variant:"text"}),null,16)]),default:t(()=>[e(Ue,{school:b.school,onClose:l[0]||(l[0]=s=>x.value=!1),onSave:l[1]||(l[1]=s=>s?x.value=!1:null)},null,8,["school"])]),_:1},8,["modelValue"])]),default:t(()=>[e(ne,null,{default:t(()=>[e(U,null,{default:t(()=>[(r(!0),q(ie,null,de(y.value,s=>(r(),N($,{key:s.id},{default:t(()=>[e(D,null,{default:t(()=>[e(p,{"no-gutters":""},{default:t(()=>[e(C,{class:"d-flex justify-start",cols:"5"},{default:t(()=>[ae("span",null,[l[5]||(l[5]=P("Tutti i ")),ae("b",null,R(a(oe)[s.dayOfWeek]),1)])]),_:2},1024),e(C,{class:"text-grey",cols:"5"},{default:t(()=>[P(" Dal "+R(a(F).fromIyyyyMMdd(s.from).format())+" al "+R(a(F).fromIyyyyMMdd(s.to).format()),1)]),_:2},1024),e(C,{cols:"1"},{default:t(()=>[e(v,{transition:"dialog-bottom-transition",fullscreen:""},{activator:t(({props:i})=>[e(f,W({icon:"mdi-pencil",variant:"text",onClick:l[3]||(l[3]=it(V=>console.log("edit"),["stop"])),ref_for:!0},i),null,16)]),default:t(({isActive:i})=>[e(Ue,{school:b.school,initialWeekLesson:s,edit:"",onClose:V=>i.value=!1,onSave:V=>V?i.value=!1:null},null,8,["school","initialWeekLesson","onClose","onSave"])]),_:2},1024)]),_:2},1024),e(C,{cols:"1"},{default:t(()=>[e(Ie,{name:"Tutti i "+a(oe)[s.dayOfWeek],objName:"Lezione Programmata",onDelete:async()=>await d(s)},{activator:t(({props:i})=>[e(f,W({icon:"mdi-delete",variant:"text",ref_for:!0},i),null,16)]),_:2},1032,["name","onDelete"])]),_:2},1024)]),_:2},1024)]),_:2},1024),e(h,null,{default:t(()=>[s.schedule.length>0?(r(),N(j,{key:0},{default:t(()=>[(r(!0),q(ie,null,de(s.schedule,i=>(r(),N(m,{key:i.studentId,value:i,color:"primary"},{prepend:t(()=>[ae("p",null,[ae("b",null,R(a(le).fromITime(i.startTime).format())+" - "+R(a(le).fromITime(i.endTime).format()),1),l[6]||(l[6]=ae("span",null," - ",-1)),ae("i",null,R(w(i.studentId)),1)])]),_:2},1032,["value"]))),128))]),_:2},1024)):(r(),q("span",Lt,"Nessuna lezione programmata"))]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),e(K,null,{default:t(()=>[e(Q),e(f,{text:"Chiudi",onClick:l[4]||(l[4]=s=>S("close"))})]),_:1})]),_:1},8,["loading"])}}}),kt=ue({__name:"LessonView",props:{school:{}},setup(A){const H=Ee(),g=ut(),S=A,I=[],y=k([]),c=k(),O=k(!1),M=k(!1),x=k(!1),d={dailyLessons:[],weeklyLessons:[],schoolId:S.school.id},u=_e(()=>S.school==null||O.value||M.value||x.value);Z(S.school,()=>b());function G(l){return l.next?"primary":l.pending?"warning":l.recovery?"info":"grey-lighten-1"}async function w(l){const f=await Ze.instance.getOrCreateDailyLessonId(d,l);H.push(`/lesson/${f}`)}async function b(){x.value=!0;const l=new Date(new Date().toDateString()),f=g.addMonths(l,-12),v=await We.instance.getSchoolLessons(S.school.id,f);y.value=await gt.instance.getGroupedLessons(v),x.value=!1}return ve(async()=>{await b()}),fe(()=>{I.forEach(l=>l==null?void 0:l())}),(l,f)=>{const v=o("v-btn"),C=o("v-date-picker"),p=o("v-col"),D=o("v-row"),m=o("v-card-text"),j=o("v-spacer"),h=o("v-card-actions"),$=o("v-card"),U=o("v-dialog"),ne=o("v-list-subheader"),Q=o("v-icon"),K=o("v-avatar"),T=o("v-list-item"),s=o("v-list");return r(),N($,{title:"Lezioni",elevation:"3",loading:u.value},{append:t(()=>[e(U,{transition:"dialog-bottom-transition",class:"justify-center"},{activator:t(({props:i})=>[e(v,W({icon:"mdi-calendar",variant:"text",disabled:!l.school},i),null,16,["disabled"])]),default:t(({isActive:i})=>[e($,{maxWidth:"400px"},{default:t(()=>[e(m,null,{default:t(()=>[e(D,{class:"justify-center"},{default:t(()=>[e(p,{cols:"auto"},{default:t(()=>[e(C,{modelValue:c.value,"onUpdate:modelValue":f[0]||(f[0]=V=>c.value=V)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(h,null,{default:t(()=>[e(j),e(v,{text:"Chiudi",onClick:V=>i.value=!1},null,8,["onClick"]),e(v,{text:"Ok",color:"primary",onClick:f[1]||(f[1]=V=>w(c.value)),disabled:!c.value},null,8,["disabled"])]),_:2},1024)]),_:2},1024)]),_:1}),e(v,{icon:"mdi-refresh",variant:"text",disabled:!l.school||x.value,onClick:b},null,8,["disabled"]),e(U,{transition:"dialog-bottom-transition",fullscreen:""},{activator:t(({props:i})=>[e(v,W({icon:"mdi-pencil",variant:"text"},i,{disabled:!l.school}),null,16,["disabled"])]),default:t(({isActive:i})=>[e(ht,{school:l.school,onClose:V=>{i.value=!1,b()}},null,8,["school","onClose"])]),_:1}),e(v,{icon:"mdi-eye-arrow-right",variant:"text",to:"/lessons/"+l.school.id},null,8,["to"])]),default:t(()=>[e(s,{lines:"two"},{default:t(()=>[(r(!0),q(ie,null,de(y.value,i=>(r(),q(ie,{key:i.month},[e(ne,{inset:""},{default:t(()=>[P(R(i.month),1)]),_:2},1024),(r(!0),q(ie,null,de(i.lessons,V=>(r(),N(T,{key:V.date.toString(),title:V.date.format(),onClick:re=>w(V),baseColor:V.next?"primary":""},Re({prepend:t(()=>[e(K,{color:G(V)},{default:t(()=>[e(Q,{color:"white"},{default:t(()=>f[2]||(f[2]=[P("mdi-calendar")])),_:1})]),_:2},1032,["color"])]),_:2},[V.pending||V.recovery?{name:"append",fn:t(()=>[V.pending?(r(),N(Q,{key:0,color:"warning"},{default:t(()=>f[3]||(f[3]=[P("mdi-alert")])),_:1})):ee("",!0),V.recovery?(r(),N(Q,{key:1,color:"info"},{default:t(()=>f[4]||(f[4]=[P("mdi-alpha-r-circle")])),_:1})):ee("",!0)]),key:"0"}:void 0]),1032,["title","onClick","baseColor"]))),128))],64))),128))]),_:1})]),_:1},8,["loading"])}}}),xt=yt(kt,[["__scopeId","data-v-c41e1ade"]]),Dt=ue({__name:"ScheduleRecoveryLessonButton",props:rt({school:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(A){const H=A,g=dt(A,"modelValue"),S=k(!1),I=k(!1),y=k(!1),c=Te({date:Se().required("La Data della Lezione di Recupero è obbligatoria").label("Data della Lezione di Recupero"),time:se().required("L'Orario della Lezione di Recupero è obbligatorio").label("Orario della Lezione di Recupero")}),{defineField:O,handleSubmit:M,resetForm:x}=$e({validationSchema:c}),d=C=>({props:{"error-messages":C.errors}}),[u,G]=O("date",d),[w,b]=O("time",d),l=M(async C=>{v()},C=>{te.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(C)});function f(){I.value=!1,u.value=void 0,w.value=void 0,x()}async function v(){if(!(!u.value||!w.value||!g.value))try{y.value=!0;const C=le.fromHHMM(w.value),p={studentId:g.value.studentId,schoolId:H.school.id,originalDailyLessonId:g.value.originalDailyLesson.id,originalLessonId:g.value.lessonId,date:u.value,startTime:C.toITime(),endTime:C.add({minutes:g.value.minutesLessonDuration}).toITime()};await Ve.instance.scheduleRecovery(g.value,p),I.value=!1}catch{te.error("Impossibile schedulare la lezione di recupero")}finally{y.value=!1}}return(C,p)=>{const D=o("v-btn"),m=o("v-date-input"),j=o("v-col"),h=o("v-time-picker"),$=o("v-dialog"),U=o("v-text-field"),ne=o("v-row"),Q=o("v-card-text"),K=o("v-spacer"),T=o("v-card-actions"),s=o("v-card");return r(),N($,{modelValue:I.value,"onUpdate:modelValue":p[5]||(p[5]=i=>I.value=i),width:"auto",scrollable:"",persistent:""},{activator:t(({props:i})=>[e(D,ct(mt(i)),{default:t(()=>p[6]||(p[6]=[P("programma")])),_:2},1040)]),default:t(()=>[e(s,{title:"Programma Lezione di Recupero",subtitle:g.value.name+" "+g.value.surname+" - "+a(F).fromIyyyyMMdd(g.value.originalDailyLesson.date).format(),loading:y.value},{default:t(()=>[e(Q,{class:"pa-6"},{default:t(()=>[e(ne,null,{default:t(()=>[e(j,{cols:"12",md:"12"},{default:t(()=>[e(m,W({modelValue:a(u),"onUpdate:modelValue":p[0]||(p[0]=i=>J(u)?u.value=i:null)},a(G),{label:"Data della Lezione di Recupero",inputmode:"none"}),null,16,["modelValue"])]),_:1}),e(j,{cols:"12",lg:"12"},{default:t(()=>[e(U,W({modelValue:a(w),"onUpdate:modelValue":p[3]||(p[3]=i=>J(w)?w.value=i:null)},a(b),{active:S.value,focused:S.value,inputmode:"none",label:"Orario della prima Lezione","prepend-icon":"mdi-clock-time-four-outline",readonly:""}),{default:t(()=>[e($,{modelValue:S.value,"onUpdate:modelValue":p[2]||(p[2]=i=>S.value=i),activator:"parent",width:"auto"},{default:t(()=>[S.value?(r(),N(h,{key:0,modelValue:a(w),"onUpdate:modelValue":p[1]||(p[1]=i=>J(w)?w.value=i:null),format:"24hr"},null,8,["modelValue"])):ee("",!0)]),_:1},8,["modelValue"])]),_:1},16,["modelValue","active","focused"])]),_:1})]),_:1})]),_:1}),e(T,null,{default:t(()=>[e(K),e(D,{text:"Annulla",onClick:f}),e(D,{color:"primary",text:"Salva",onClick:p[4]||(p[4]=i=>a(l)(i))})]),_:1})]),_:1},8,["subtitle","loading"])]),_:1},8,["modelValue"])}}}),Vt={key:0},wt={key:1},Ct={key:2},It={key:0},Mt={key:1},Tt={key:0},$t={key:2},zt={key:0},Nt=ue({__name:"RecoveryLessonView",props:{school:{}},setup(A){const H=A,g=_e(()=>H.school.id),S=et.instance.observe(g),I=Pe(S),y=k(),c=k(!1),O=k(!1);Z(I,async()=>x());async function M(d){try{O.value=!0,await Ve.instance.cancelRecovery(d)}catch{te.warn("Impossibile annullare la lezione di recupero")}finally{O.value=!1}}async function x(){if(I.value)try{c.value=!0,y.value=await Ve.instance.computeDailyLessons(I.value),console.log(y)}catch{te.warning("Impossibile caricare le Lezioni di Recupero")}finally{c.value=!1}}return(d,u)=>{const G=o("v-list-subheader"),w=o("v-list-item"),b=o("v-btn"),l=o("v-icon"),f=o("v-divider"),v=o("v-list"),C=o("v-card-text"),p=o("v-card");return r(),N(p,{title:"Recuperi",elevation:"3",loading:c.value},{default:t(()=>[e(v,{lines:"three"},{default:t(()=>{var D;return[(r(!0),q(ie,null,de((D=y.value)==null?void 0:D.recoveryMap,(m,j)=>(r(),q(ie,{key:m.type},[e(G,{inset:""},{default:t(()=>[ae("b",null,R(a(lt)[m.type]),1)]),_:2},1024),m.recoveries.length==0?(r(),N(w,{key:0},{default:t(()=>[m.type=="unset"?(r(),q("div",Vt," Nessuna lezione da recuperare ")):m.type=="pending"?(r(),q("div",wt," Nessuna lezione di recupero programmata ")):(r(),q("div",Ct," Nessuna lezione di recupero effettuata "))]),_:2},1024)):ee("",!0),(r(!0),q(ie,null,de(m.recoveries,(h,$)=>(r(),N(w,{key:`${h.lessonId}_${h.originalDailyLesson.id}`},{title:t(()=>[P(R(h.name)+" "+R(h.surname),1)]),subtitle:t(()=>[m.type=="unset"?(r(),q("div",It," Da recuperare la lezione del "+R(a(F).fromIyyyyMMdd(h.originalDailyLesson.date).format()),1)):m.type=="pending"?(r(),q("div",Mt,[P(" Recupero della lezione del "+R(a(F).fromIyyyyMMdd(h.originalDailyLesson.date).format())+" programmato ",1),h.recoveryDailyLesson?(r(),q("span",Tt," per il "+R(a(F).fromIyyyyMMdd(h.recoveryDailyLesson.date).format()),1)):ee("",!0)])):(r(),q("div",$t,[P(" Recupero della lezione del "+R(a(F).fromIyyyyMMdd(h.originalDailyLesson.date).format())+" effettuato ",1),h.recoveryDailyLesson?(r(),q("span",zt," il "+R(a(F).fromIyyyyMMdd(h.recoveryDailyLesson.date).format()),1)):ee("",!0)]))]),append:t(()=>[m.type=="unset"?(r(),N(Dt,{key:0,modelValue:m.recoveries[$],"onUpdate:modelValue":U=>m.recoveries[$]=U,school:d.school},null,8,["modelValue","onUpdate:modelValue","school"])):m.type=="pending"?(r(),N(b,{key:1,onClick:U=>M(h),loading:O.value,disabled:O.value},{default:t(()=>u[0]||(u[0]=[P("annulla")])),_:2},1032,["onClick","loading","disabled"])):h.recoveryStatus==a(at).CANCELLED?(r(),N(l,{key:2,color:"warning"},{default:t(()=>u[1]||(u[1]=[P(" mdi-cancel ")])),_:1})):(r(),N(l,{key:3,color:"success"},{default:t(()=>u[2]||(u[2]=[P(" mdi-check-all ")])),_:1}))]),_:2},1024))),128)),j!=2?(r(),N(f,{key:1})):ee("",!0)],64))),128))]}),_:1}),y.value?ee("",!0):(r(),N(C,{key:0},{default:t(()=>u[3]||(u[3]=[P(" Nessun recupero in programma ")])),_:1}))]),_:1},8,["loading"])}}}),At=ue({__name:"SchoolView",setup(A){const H=vt(),g=Ee(),S=_e(()=>H.params.id),I=_t.instance.observe(S),y=Pe(I),c=[],O=k([]);async function M(){if(!y.value)return!1;try{return We.instance.delete(I.value),g.push("/"),!0}catch{return!1}}async function x(){const d=[{id:0,title:"Questa è una nota molto carina e paffutella",description:"",student:"Matteo Rossi"},{id:1,title:"Questa è una nota con descrizione",description:"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Ut viverra tincidunt risus sit amet interdum. Nam sed leo id ipsum efficitur congue nec ut est. Nullam in metus leo. In commodo, leo eu vulputate euismod, urna lacus efficitur nibh, ut maximus felis metus eu odio. Duis cursus commodo auctor. Suspendisse condimentum lorem dui, id tristique lectus commodo nec.",student:"Luca Verdi"}];O.value=d}return ve(async()=>{await x()}),fe(()=>{c.forEach(d=>d())}),(d,u)=>{const G=o("v-btn"),w=o("v-list-item"),b=o("v-dialog"),l=o("v-list"),f=o("v-menu"),v=o("v-col"),C=o("v-row"),p=o("v-expansion-panel-title"),D=o("v-expansion-panel-text"),m=o("v-expansion-panel"),j=o("v-expansion-panels"),h=o("v-card");return a(y)?(r(),N(h,{key:0,class:"pa-3",title:a(y).name,elevation:"0"},{prepend:t(()=>[e(ot)]),append:t(()=>[e(f,{transition:"slide-y-transition"},{activator:t(({props:$})=>[e(G,W({icon:"mdi-dots-vertical",variant:"text"},$),null,16)]),default:t(()=>[e(l,null,{default:t(()=>[e(b,{fullscreen:""},{activator:t(({props:$})=>[e(w,W({title:"Modifica"},$),null,16)]),default:t(({isActive:$})=>[e(nt,{edit:"",initialSchool:a(y),onClose:U=>$.value=!1,onSave:U=>$.value=!1},null,8,["initialSchool","onClose","onSave"])]),_:1}),e(Ie,{name:a(y).name,objName:"Scuola",onDelete:M},{activator:t(({props:$})=>[e(w,W({title:"Elimina"},$),null,16)]),_:1},8,["name"])]),_:1})]),_:1})]),default:t(()=>[e(C,{class:"mt-5"},{default:t(()=>[e(v,{class:"pa-2",cols:"12",md:"6"},{default:t(()=>[e(xt,{school:a(y)},null,8,["school"])]),_:1}),e(v,{class:"pa-2",cols:"12",md:"6"},{default:t(()=>[e(Nt,{school:a(y)},null,8,["school"])]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(v,{class:"pa-2",cols:"12",md:"6"},{default:t(()=>[e(bt,{school:a(y)},null,8,["school"])]),_:1})]),_:1}),e(C,null,{default:t(()=>[e(v,{class:"pa-2",cols:"12"},{default:t(()=>[e(h,{title:"Note",elevation:"3"},{default:t(()=>[e(j,null,{default:t(()=>[(r(!0),q(ie,null,de(O.value,$=>(r(),N(m,{key:$.id},{default:t(()=>[e(p,null,{default:t(()=>[e(C,{"no-gutters":""},{default:t(()=>[e(v,{class:"d-flex justify-start",cols:"8"},{default:t(()=>[P(R($.title),1)]),_:2},1024),e(v,{class:"text-grey",cols:"4"},{default:t(()=>[ae("span",null,R($.student),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),e(D,null,{default:t(()=>[P(R($.description),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["title"])):ee("",!0)}}});export{At as default};

import{d as J,r as w,u as Q,v as W,i as h,s as P,b as l,e as A,c as S,w as i,f as a,m as q,z as _,A as B,j as R,a8 as F,B as G,C as X,L as Y,M as Z,a9 as E,N as ee,O as te,o as oe,W as ae}from"./index-qu0X8Y0F.js";import{T as g,y as ne,d as le}from"./model-DoMqyngq.js";import{u as ie}from"./vee-validate.esm-1pLNcP7m.js";const se=J({__name:"EditLessonTime",props:{startTime:{},endTime:{},minutesOfLesson:{default:60}},emits:["close","save"],setup(M,{emit:I}){const n=M,x=I,m=w(!1),f=w(!1),T=w(!0),v=Q({startTime:W().required("L'Orario di inizio Lezione è obbligatorio").label("Orario di inizio Lezione"),endTime:W().required("L'Orario di fine Lezione è obbligatorio").label("Orario di fine Lezione")}),{defineField:k,handleSubmit:z}=ie({validationSchema:v}),H=e=>({props:{"error-messages":e.errors}}),[d,N]=k("startTime",H),[p,O]=k("endTime",H),j=z(async e=>{var o,r;if((((o=g.fromHHMM(d.value))==null?void 0:o.getTotalMinutes())??0)>(((r=g.fromHHMM(p.value))==null?void 0:r.getTotalMinutes())??0)){h.warning("L'orario di inizio lezione deve essere antecedente all'orario di fine lezione");return}x("save",{...e})},e=>{h.warn("Ci sono alcuni errori! Inserisci correttamente i dati"),console.log(e)});P(n,()=>U(),{immediate:!0}),P(d,()=>t()),P(T,()=>t());function U(){n.startTime&&(d.value=n.startTime),n.endTime&&(p.value=n.endTime),t()}function t(){if(T.value&&n.minutesOfLesson!=null){const e=g.fromHHMM(d.value);if(!e)return;p.value=g.fromITime((e.getTotalMinutes()+n.minutesOfLesson)*60).format()}}return(e,o)=>{const r=l("v-checkbox"),u=l("v-col"),y=l("v-time-picker"),V=l("v-dialog"),b=l("v-text-field"),c=l("v-row"),C=l("v-card-text"),D=l("v-spacer"),L=l("v-btn"),$=l("v-card-actions"),K=l("v-card");return A(),S(K,{title:"Modifica orario lezione",elevation:"2"},{default:i(()=>[a(C,null,{default:i(()=>[a(c,{justify:"space-around"},{default:i(()=>[a(u,{cols:"11",md:"6"},{default:i(()=>[a(r,{modelValue:T.value,"onUpdate:modelValue":o[0]||(o[0]=s=>T.value=s),label:"Allinea la data di fine lezione in base alla durata della lezione definita dallo studente"},null,8,["modelValue"])]),_:1}),a(u,{cols:"11",sm:"5"},{default:i(()=>[a(b,q({modelValue:_(d),"onUpdate:modelValue":o[3]||(o[3]=s=>B(d)?d.value=s:null),active:m.value,focus:m.value,label:"Data di inizio"},_(N),{"prepend-icon":"mdi-clock-time-four-outline",readonly:""}),{default:i(()=>[a(V,{modelValue:m.value,"onUpdate:modelValue":o[2]||(o[2]=s=>m.value=s),activator:"parent",width:"auto"},{default:i(()=>[m.value?(A(),S(y,{key:0,format:"24hr",modelValue:_(d),"onUpdate:modelValue":o[1]||(o[1]=s=>B(d)?d.value=s:null)},null,8,["modelValue"])):R("",!0)]),_:1},8,["modelValue"])]),_:1},16,["modelValue","active","focus"])]),_:1}),a(u,{cols:"11",sm:"5"},{default:i(()=>[a(b,q({modelValue:_(p),"onUpdate:modelValue":o[6]||(o[6]=s=>B(p)?p.value=s:null),active:f.value,focused:f.value,label:"Data di fine"},_(O),{"prepend-icon":"mdi-clock-time-four-outline",disabled:T.value,readonly:""}),{default:i(()=>[a(V,{modelValue:f.value,"onUpdate:modelValue":o[5]||(o[5]=s=>f.value=s),activator:"parent",width:"auto"},{default:i(()=>[f.value?(A(),S(y,{key:0,format:"24hr",modelValue:_(p),"onUpdate:modelValue":o[4]||(o[4]=s=>B(p)?p.value=s:null)},null,8,["modelValue"])):R("",!0)]),_:1},8,["modelValue"])]),_:1},16,["modelValue","active","focused","disabled"])]),_:1})]),_:1})]),_:1}),a($,null,{default:i(()=>[a(D),a(L,{text:"Annulla",variant:"plain",onClick:o[7]||(o[7]=F(s=>x("close"),["stop"]))}),a(L,{color:"primary",text:"Modifica",variant:"tonal",onClick:F(_(j),["stop"])},null,8,["onClick"])]),_:1})]),_:1})}}}),de=J({__name:"DailyLessonCalendar",props:G({date:{default:()=>ne.today()},editable:{type:Boolean,default:!1},showDay:{type:Boolean,default:!1},sort:{type:Boolean,default:!1}},{modelValue:{default:[]},modelModifiers:{}}),emits:G(["edit"],["update:modelValue"]),setup(M,{emit:I}){const n=M,x=I,m=X(M,"modelValue"),f=w([]),T=w(!1);P(m,()=>d(),{deep:!0});const v=Y(),k=Z(),z=E(15),H=ee({locale:"it-IT",selectedDate:n.date.toIyyyyMMdd("-"),views:[te()],events:[],plugins:n.editable?[z,v,k]:[z,v],callbacks:{onEventUpdate(t){const e=f.value.find(o=>o.id==t.id);e&&(e.start=t.start,e.end=t.end,O(t))}}});function d(){f.value=N(),f.value.forEach(t=>{t._options||(t._options={}),t._options.disableDND=!n.editable,v.get(t.id)?v.update(t):v.add(t)}),console.log("updateInternalEvents",v.getAll(),n.date),v.getAll().forEach(t=>{f.value.findIndex(o=>o.id==t.id)==-1&&v.remove(t.id)})}function N(){const t=n.date.toIyyyyMMdd("-");return m.value.map(e=>"lessonId"in e?(console.log(e),{id:e.lessonId,start:t+" "+g.fromITime(e.startTime).format(),end:t+" "+g.fromITime(e.endTime).format(),title:`${e.name} ${e.surname} - ${le[e.lessonDay??0]}`,data:{...e}}):e)}function p(t,e){var V,b;if(!t)return;const o=f.value.find(c=>c.id==t.id);if(!o)return;const r={...t},u=(V=r.start)==null?void 0:V.split(" "),y=(b=r.end)==null?void 0:b.split(" ");o.start=u[0]+" "+e.startTime,o.end=y[0]+" "+e.endTime,O(o),T.value=!1}function O(t){var o,r;const e=m.value.find(u=>"lessonId"in u?u.lessonId==t.id:u.id==t.id);e&&("lessonId"in e?(e.startTime=((o=g.fromHHMM(t.start.split(" ")[1]))==null?void 0:o.toITime())??e.startTime,e.endTime=((r=g.fromHHMM(t.end.split(" ")[1]))==null?void 0:r.toITime())??e.endTime):(e.start=t.start,e.end=t.end),n.sort&&m.value.sort((u,y)=>u.startTime-y.startTime),x("edit"))}function j(){const t=document.getElementsByClassName("sx__calendar-header")[0];t.style.display=t.style.display=="none"?"":"none",U()}function U(t=0){const e=document.getElementsByClassName("sx__week-header")[0];e?e.style.display=n.showDay?"":"none":t>=10?console.error("Unable to hide day header"):setTimeout(()=>U(t+1),10)}return oe(()=>{j(),d()}),(t,e)=>{const o=l("v-spacer"),r=l("v-btn"),u=l("v-dialog"),y=l("v-card-actions"),V=l("v-card"),b=l("v-container");return A(),S(b,null,{default:i(()=>[a(_(ae),{"calendar-app":_(H)},{eventModal:i(({calendarEvent:c})=>[a(V,{elevation:"3",title:c.title,subtitle:c.start.split(" ")[1]+" - "+c.end.split(" ")[1],text:c.description},{default:i(()=>[a(y,null,{default:i(()=>[a(o),a(u,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=C=>T.value=C),transition:"dialog-bottom-transition"},{activator:i(({props:C})=>[a(r,{text:"Chiudi",onClick:e[0]||(e[0]=D=>_(k).close())}),a(r,q({text:"Modifica",color:"primary"},C,{onClick:e[1]||(e[1]=F(()=>{},["stop"]))}),null,16)]),default:i(({isActive:C})=>{var D,L;return[a(se,{onClose:$=>C.value=!1,onSave:$=>p(c,$),startTime:(D=c.start)==null?void 0:D.split(" ")[1],endTime:(L=c.end)==null?void 0:L.split(" ")[1],minutesOfLesson:c.data.minutesLessonDuration},null,8,["onClose","onSave","startTime","endTime","minutesOfLesson"])]}),_:2},1032,["modelValue"])]),_:2},1024)]),_:2},1032,["title","subtitle","text"])]),_:1},8,["calendar-app"])]),_:1})}}}),re=(M,I)=>{const n=M.__vccOpts||M;for(const[x,m]of I)n[x]=m;return n},fe=re(de,[["__scopeId","data-v-a762334b"]]);export{fe as D,re as _};
